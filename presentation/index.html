<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pismo Disputes Workflow: A Developer's Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre-d3@0.6.4/dist/dagre-d3.min.js"></script>
    <style>
        /* Dagre-D3 State Machine Styles */
        .dagre-state-machine .node rect {
            stroke-width: 2px;
            rx: 8px;
            ry: 8px;
        }
        .dagre-state-machine .node.state-blue rect {
            fill: #dbeafe;
            stroke: #3b82f6;
        }
        .dagre-state-machine .node.state-blue .label {
            fill: #1e40af;
        }
        .dagre-state-machine .node.state-amber rect {
            fill: #fef3c7;
            stroke: #f59e0b;
        }
        .dagre-state-machine .node.state-amber .label {
            fill: #92400e;
        }
        .dagre-state-machine .node.state-green rect {
            fill: #dcfce7;
            stroke: #16a34a;
        }
        .dagre-state-machine .node.state-green .label {
            fill: #166534;
        }
        .dagre-state-machine .node.state-red rect {
            fill: #fee2e2;
            stroke: #dc2626;
        }
        .dagre-state-machine .node.state-red .label {
            fill: #991b1b;
        }
        .dagre-state-machine .node.state-gray rect {
            fill: #f3f4f6;
            stroke: #6b7280;
        }
        .dagre-state-machine .node.state-gray .label {
            fill: #374151;
        }
        .dagre-state-machine .node.state-purple rect {
            fill: #e0e7ff;
            stroke: #8b5cf6;
        }
        .dagre-state-machine .node.state-purple .label {
            fill: #4338ca;
        }
        .dagre-state-machine .edgePath path.path {
            stroke: #6b7280;
            stroke-width: 2px;
            fill: none;
        }
        .dagre-state-machine .edgePath.edge-green path.path {
            stroke: #16a34a;
        }
        .dagre-state-machine .edgePath.edge-red path.path {
            stroke: #dc2626;
        }
        .dagre-state-machine .edgePath.edge-dashed path.path {
            stroke-dasharray: 5, 3;
        }
        .dagre-state-machine .edgePath marker path {
            fill: #6b7280;
        }
        .dagre-state-machine .edgePath.edge-green marker path {
            fill: #16a34a;
        }
        .dagre-state-machine .edgePath.edge-red marker path {
            fill: #dc2626;
        }
        .dagre-state-machine .edgeLabel {
            font-size: 10px;
            font-weight: 500;
        }
        .dagre-state-machine .edgeLabel.label-green {
            fill: #16a34a;
        }
        .dagre-state-machine .edgeLabel.label-red {
            fill: #dc2626;
        }
        .dagre-state-machine .node {
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .dagre-state-machine .node:hover rect {
            stroke-width: 3px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }
        .slide { display: none; min-height: 100vh; }
        .slide.active { display: flex; }
        .state-node { transition: all 0.3s ease; }
        .state-node:hover { transform: scale(1.05); }
        .timeline-dot::before { content: ''; position: absolute; left: 50%; top: 100%; width: 2px; height: 40px; background: #d1d5db; transform: translateX(-50%); }
        .timeline-dot:last-child::before { display: none; }
        .dropzone { border: 2px dashed #cbd5e1; transition: all 0.2s ease; }
        .dropzone:hover { border-color: #2563eb; background: #eff6ff; }
        .state-minimap {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            width: 340px;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 0.75rem;
            z-index: 45;
        }
        .state-minimap.visible { display: block; }
        .minimap-title {
            font-size: 0.65rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .minimap-svg {
            width: 100%;
            height: auto;
        }
        .minimap-node {
            transition: all 0.3s ease;
        }
        .minimap-node rect {
            fill: #e5e7eb;
            stroke: #d1d5db;
            stroke-width: 1.5;
            transition: all 0.3s ease;
        }
        .minimap-node text {
            fill: #6b7280;
            font-size: 7px;
            font-weight: 600;
            font-family: system-ui, -apple-system, sans-serif;
            text-anchor: middle;
            dominant-baseline: middle;
            transition: all 0.3s ease;
        }
        .minimap-node.completed rect {
            fill: #16a34a;
            stroke: #15803d;
        }
        .minimap-node.completed text {
            fill: white;
        }
        .minimap-node.current rect {
            fill: #3b82f6;
            stroke: #1e40af;
            filter: drop-shadow(0 0 4px rgba(59, 130, 246, 0.4));
        }
        .minimap-node.current text {
            fill: white;
        }
        .minimap-node.upcoming rect {
            fill: #f3f4f6;
            stroke: #d1d5db;
        }
        .minimap-node.upcoming text {
            fill: #9ca3af;
        }
        .minimap-arrow {
            fill: none;
            stroke: #d1d5db;
            stroke-width: 1.5;
            transition: all 0.3s ease;
        }
        .minimap-arrow.completed {
            stroke: #16a34a;
        }
        .minimap-arrow.current {
            stroke: #3b82f6;
        }
        .minimap-arrowhead {
            fill: #d1d5db;
            transition: all 0.3s ease;
        }
        .minimap-arrowhead.completed {
            fill: #16a34a;
        }
        .minimap-arrowhead.current {
            fill: #3b82f6;
        }
        /* Progressive reveal styles */
        [data-reveal-segment] {
            opacity: 0;
            transform: translateY(20px);
        }
        [data-reveal-segment].revealed {
            opacity: 1;
            transform: translateY(0);
        }
        /* Highlight animation */
        .segment-highlight {
            position: relative;
        }
        .segment-highlight::before {
            content: '';
            position: absolute;
            inset: -4px;
            background: rgba(253, 224, 71, 0.5);
            border-radius: 4px;
            opacity: 0;
            z-index: -1;
            animation: highlightPulse 2s ease-in-out;
        }
        @keyframes highlightPulse {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        /* Icon hint overlay styles */
        #icon-hint {
            transition: opacity 0.3s ease;
        }
        #icon-hint svg {
            width: 120px;
            height: 120px;
            opacity: 0;
            stroke-width: 1.5;
        }
        .icon-pulse {
            animation: iconPulse 1.5s ease-in-out forwards;
        }
        @keyframes iconPulse {
            0% { opacity: 0; transform: scale(0.8); }
            15% { opacity: 0.5; transform: scale(1.05); }
            25% { opacity: 0.4; transform: scale(1); }
            75% { opacity: 0.4; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.95); }
        }
        /* Multiple icons container */
        #icon-container {
            display: flex;
            gap: 2rem;
            align-items: center;
            justify-content: center;
        }
        #icon-container.multi-icon svg {
            width: 80px;
            height: 80px;
        }

        /* Contextual floating visuals - BEHIND text */
        .floating-visual {
            position: absolute;
            opacity: 0;
            z-index: 0;
            pointer-events: none;
        }

        .floating-visual svg {
            width: 500px;
            height: 380px;
            filter: drop-shadow(0 12px 24px rgba(0,0,0,0.08));
            opacity: 0.18;
        }

        /* Make slide content appear above SVGs */
        .slide > div {
            position: relative;
            z-index: 10;
        }

        /* Parallax positions - centered for large SVGs */
        .visual-left { left: 5%; top: 20%; }
        .visual-center { left: 50%; top: 15%; transform: translateX(-50%); }
        .visual-right { right: 5%; top: 20%; }
        .visual-bottom-left { left: 10%; bottom: 15%; }
        .visual-bottom-right { right: 10%; bottom: 15%; }
        .visual-top-left { left: 8%; top: 10%; }
        .visual-top-right { right: 8%; top: 10%; }

        /* Slide in from right, out to left animation */
        @keyframes slideInFromRight {
            0% {
                opacity: 0;
                transform: translateX(100vw);
            }
            100% {
                opacity: 0.7;
                transform: translateX(0);
            }
        }

        @keyframes slideOutToLeft {
            0% {
                opacity: 0.7;
                transform: translateX(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-100vw);
            }
        }

        .floating-visual {
            transform: translateX(100vw);
        }

        .floating-visual.slide-in {
            animation: slideInFromRight 0.8s ease-out forwards;
        }

        .floating-visual.slide-out {
            animation: slideOutToLeft 0.6s ease-in forwards;
        }

        /* Gentle float while visible */
        .floating-visual.floating {
            animation: gentleFloat 3s ease-in-out infinite;
        }

        @keyframes gentleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
    <!-- Disclaimer Footer -->
    <div class="fixed bottom-0 left-0 w-full bg-gray-100 border-t border-gray-200 py-2 px-4 z-50 text-center">
        <p class="text-xs text-gray-500">
            <strong>Disclaimer:</strong> This presentation is for educational purposes only.
            All Pismo API information sourced from <a href="https://developers.pismo.io" target="_blank" class="text-blue-600 hover:underline">developers.pismo.io</a>.
            Pismo is a trademark of Pismo Solutions. This project is not affiliated with or endorsed by Pismo.
        </p>
    </div>

    <!-- Progress Bar -->
    <div class="fixed top-0 left-0 w-full h-1 bg-gray-200 z-50">
        <div id="progress" class="h-full bg-blue-600 transition-all duration-300" style="width: 5.56%"></div>
    </div>

    <!-- Icon hint overlay -->
    <div id="icon-hint" class="fixed inset-0 flex items-center justify-center z-30 pointer-events-none opacity-0">
        <div id="icon-container" class="text-gray-300">
            <!-- Icons will be dynamically inserted here -->
        </div>
    </div>

    <!-- Contextual visuals overlay -->
    <div id="contextual-visuals" class="fixed inset-0 pointer-events-none z-20 overflow-hidden">
        <!-- Floating visuals will be inserted here -->
    </div>

    <!-- Navigation -->
    <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 flex items-center gap-4 bg-white px-6 py-3 rounded-full shadow-xl border border-gray-100 z-50">
        <button id="prevBtn" class="p-2 rounded-full hover:bg-gray-100 disabled:opacity-50" disabled>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
        </button>
        <span id="slideCounter" class="text-sm font-medium text-gray-600">1 / 18</span>
        <button id="nextBtn" class="p-2 rounded-full hover:bg-gray-100">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </button>
        <div class="w-px h-6 bg-gray-300"></div>
        <button id="audioBtn" class="p-2 rounded-full hover:bg-gray-100" title="Play/Pause Audio">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        </button>
        <button id="autoPlayBtn" class="p-2 rounded-full hover:bg-gray-100" title="Toggle Auto-Play (auto-advance slides)">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
        </button>
    </div>

    <!-- Subtitle Container -->
    <div id="subtitle-container" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 z-40 opacity-0">
        <div class="flex items-start gap-3 max-w-3xl">
            <div id="avatar" class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg shrink-0 shadow-lg">A</div>
            <div id="speech-bubble" class="bg-white rounded-lg shadow-lg p-4 relative">
                <div class="absolute left-[-8px] top-4 w-0 h-0 border-t-8 border-b-8 border-r-8 border-transparent border-r-white"></div>
                <p id="subtitle-text" class="text-gray-800 text-sm leading-relaxed"></p>
            </div>
        </div>
    </div>

    <!-- Mini State Map - SVG Flowchart -->
    <div id="minimap" class="state-minimap">
        <div class="minimap-title">Dispute State Machine</div>
        <svg class="minimap-svg" viewBox="0 0 320 160" xmlns="http://www.w3.org/2000/svg">
            <!-- Arrowhead marker definitions -->
            <defs>
                <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                    <polygon class="minimap-arrowhead" data-arrow="default" points="0 0, 6 2, 0 4" />
                </marker>
                <marker id="arrowhead-completed" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                    <polygon class="minimap-arrowhead completed" points="0 0, 6 2, 0 4" />
                </marker>
                <marker id="arrowhead-current" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                    <polygon class="minimap-arrowhead current" points="0 0, 6 2, 0 4" />
                </marker>
            </defs>

            <!-- Row 1: Main flow -->
            <!-- PENDING node -->
            <g class="minimap-node" data-state="pending">
                <rect x="5" y="10" width="45" height="20" rx="3"/>
                <text x="27.5" y="20">PENDING</text>
            </g>

            <!-- Arrow: PENDING -> OPENED -->
            <path class="minimap-arrow" data-arrow="pending-opened" d="M50 20 L60 20" marker-end="url(#arrowhead)"/>

            <!-- OPENED node -->
            <g class="minimap-node" data-state="opened">
                <rect x="65" y="10" width="45" height="20" rx="3"/>
                <text x="87.5" y="20">OPENED</text>
            </g>

            <!-- Arrow: OPENED -> CHARGEBACK -->
            <path class="minimap-arrow" data-arrow="opened-chargeback" d="M110 20 L120 20" marker-end="url(#arrowhead)"/>

            <!-- CHARGEBACK node -->
            <g class="minimap-node" data-state="chargeback">
                <rect x="125" y="10" width="55" height="20" rx="3"/>
                <text x="152.5" y="20">CHARGEBACK</text>
            </g>

            <!-- Row 2: Second Presentment path -->
            <!-- Arrow: CHARGEBACK -> 2ND_PRES (down and right) -->
            <path class="minimap-arrow" data-arrow="chargeback-2ndpres" d="M152.5 30 L152.5 45 L165 45" marker-end="url(#arrowhead)"/>

            <!-- 2ND_PRES node -->
            <g class="minimap-node" data-state="2ndpres">
                <rect x="170" y="35" width="50" height="20" rx="3"/>
                <text x="195" y="45">2ND PRES</text>
            </g>

            <!-- Arrow: 2ND_PRES -> PRE-ARB -->
            <path class="minimap-arrow" data-arrow="2ndpres-prearb" d="M195 55 L195 70 L210 70" marker-end="url(#arrowhead)"/>

            <!-- PRE-ARB node -->
            <g class="minimap-node" data-state="prearb">
                <rect x="215" y="60" width="50" height="20" rx="3"/>
                <text x="240" y="70">PRE-ARB</text>
            </g>

            <!-- Terminal states row -->
            <!-- Arrow: CHARGEBACK -> WON (direct win path) -->
            <path class="minimap-arrow" data-arrow="chargeback-won" d="M180 20 L240 20 L240 100 L255 100" marker-end="url(#arrowhead)"/>

            <!-- Arrow: 2ND_PRES -> WON -->
            <path class="minimap-arrow" data-arrow="2ndpres-won" d="M220 45 L240 45 L240 100 L255 100" marker-end="url(#arrowhead)"/>

            <!-- Arrow: PRE-ARB -> WON -->
            <path class="minimap-arrow" data-arrow="prearb-won" d="M265 70 L275 70 L275 100 L275 100" marker-end="url(#arrowhead)"/>

            <!-- WON node (green terminal) -->
            <g class="minimap-node terminal-win" data-state="won">
                <rect x="260" y="90" width="35" height="20" rx="3" style="fill: #dcfce7; stroke: #16a34a;"/>
                <text x="277.5" y="100" style="fill: #16a34a;">WON</text>
            </g>

            <!-- LOSS node (red terminal) -->
            <g class="minimap-node terminal-loss" data-state="loss">
                <rect x="260" y="115" width="35" height="20" rx="3" style="fill: #fee2e2; stroke: #dc2626;"/>
                <text x="277.5" y="125" style="fill: #dc2626;">LOSS</text>
            </g>

            <!-- Arrow: PRE-ARB -> LOSS -->
            <path class="minimap-arrow" data-arrow="prearb-loss" d="M265 80 L275 80 L275 115" marker-end="url(#arrowhead)"/>

            <!-- DENIED node -->
            <g class="minimap-node terminal-denied" data-state="denied">
                <rect x="5" y="115" width="45" height="20" rx="3" style="fill: #fef3c7; stroke: #d97706;"/>
                <text x="27.5" y="125" style="fill: #d97706;">DENIED</text>
            </g>

            <!-- Arrow: OPENED -> DENIED -->
            <path class="minimap-arrow" data-arrow="opened-denied" d="M87.5 30 L87.5 80 L27.5 80 L27.5 115" marker-end="url(#arrowhead)"/>

            <!-- EXPIRED node -->
            <g class="minimap-node terminal-expired" data-state="expired">
                <rect x="55" y="115" width="45" height="20" rx="3" style="fill: #f3f4f6; stroke: #6b7280;"/>
                <text x="77.5" y="125" style="fill: #6b7280;">EXPIRED</text>
            </g>

            <!-- Arrow: 2ND_PRES -> EXPIRED -->
            <path class="minimap-arrow" data-arrow="2ndpres-expired" d="M170 50 L140 50 L140 90 L77.5 90 L77.5 115" marker-end="url(#arrowhead)"/>

            <!-- Legend -->
            <g transform="translate(5, 145)">
                <rect x="0" y="0" width="8" height="8" rx="1" fill="#16a34a"/>
                <text x="12" y="7" style="font-size: 6px; fill: #6b7280;">Completed</text>
                <rect x="55" y="0" width="8" height="8" rx="1" fill="#3b82f6"/>
                <text x="67" y="7" style="font-size: 6px; fill: #6b7280;">Current</text>
                <rect x="105" y="0" width="8" height="8" rx="1" fill="#e5e7eb"/>
                <text x="117" y="7" style="font-size: 6px; fill: #6b7280;">Upcoming</text>
            </g>
        </svg>
    </div>

    <!-- Slide 1: Title -->
    <section class="slide active flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 1 of 18</div>
        <div class="max-w-4xl text-center">
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-full text-sm font-medium mb-8 border border-blue-200">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                Developer Training Series
            </div>
            <h1 class="text-6xl font-bold text-gray-900 mb-6 slide-title">Pismo Disputes Workflow</h1>
            <p class="text-2xl text-gray-600 mb-8 slide-subtitle">A Developer's Guide to State Machines & UI Patterns</p>
            <div class="flex items-center justify-center gap-6 text-sm text-gray-500">
                <span class="flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> 20 min</span>
                <span class="flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg> 18 slides</span>
                <span class="flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg> Visa, MC, ELO</span>
            </div>
        </div>
    </section>

    <!-- Slide 2: Introduction -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 2 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-4 slide-title">What Are Disputes?</h2>
            <p class="text-xl text-gray-600 mb-10 slide-subtitle">Understanding the financial stakes</p>
            <!-- Segment 3: "$200B" statistic mentioned first - reveal stats card -->
            <div class="bg-blue-50 border border-blue-200 text-gray-900 p-6 rounded-md slide-card mb-10" data-reveal-segment="3">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm mb-1">Global Chargeback Volume (2024)</p>
                        <p class="text-3xl font-bold text-gray-900">$117.47 Billion</p>
                    </div>
                    <div class="text-right">
                        <p class="text-gray-600 text-sm mb-1">Average Cost Per Dispute</p>
                        <p class="text-3xl font-bold text-gray-900">$190</p>
                    </div>
                </div>
            </div>
            <!-- Segment 4: "For issuers..." reveals all 3 type cards together -->
            <div class="grid grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-md slide-card border-t-4 border-red-500" data-reveal-segment="4">
                    <div class="w-12 h-12 bg-red-50 rounded-lg flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Fraud Claims</h3>
                    <p class="text-gray-600 text-sm">Unauthorized transactions, identity theft, card-not-present fraud</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md slide-card border-t-4 border-blue-500" data-reveal-segment="4">
                    <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Merchant Errors</h3>
                    <p class="text-gray-600 text-sm">Duplicate charges, wrong amounts, goods not received</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md slide-card border-t-4 border-amber-500" data-reveal-segment="4" data-highlight-segment="5">
                    <div class="w-12 h-12 bg-amber-50 rounded-lg flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Friendly Fraud</h3>
                    <p class="text-gray-600 text-sm">Legitimate purchases disputed by cardholder</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 3: Dispute Types -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 3 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-4 slide-title">Types of Disputes</h2>
            <p class="text-xl text-gray-600 mb-10 slide-subtitle">Know what you're dealing with</p>
            <!-- Slide 3 reveals: Seg 1=Merchant Error, Seg 3=Identity Fraud, Seg 5=Friendly Fraud -->
            <div class="space-y-4">
                <!-- Merchant Error - Revealed on Segment 1 when Alex says "First up: Merchant Error" -->
                <div class="bg-white p-6 rounded-lg shadow-md flex items-start gap-6 slide-card" data-reveal-segment="1" data-highlight-segment="2">
                    <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="font-semibold text-xl">Merchant Error</h3>
                            <span class="text-xs font-medium px-2 py-0.5 bg-blue-100 text-blue-700 rounded">Common</span>
                        </div>
                        <p class="text-gray-600 mb-3">Processing mistakes, duplicate charges, incorrect amounts, or goods not delivered.</p>
                        <p class="text-sm text-gray-500">Visa: 12.1-12.7, 13.1-13.7 | Mastercard: 4831, 4834, 4853-4860 | ELO: 201-304</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-700">45%</p>
                        <p class="text-xs text-gray-500">of disputes</p>
                    </div>
                </div>
                <!-- Identity Fraud - Revealed on Segment 3 when Alex says "Second category is Identity Fraud" -->
                <div class="bg-white p-6 rounded-lg shadow-md flex items-start gap-6 slide-card" data-reveal-segment="3" data-highlight-segment="4">
                    <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/></svg>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="font-semibold text-xl">Identity Fraud</h3>
                            <span class="text-xs font-medium px-2 py-0.5 bg-red-100 text-red-700 rounded">High Priority</span>
                        </div>
                        <p class="text-gray-600 mb-3">Card stolen or compromised. Cardholder did not authorize the transaction.</p>
                        <p class="text-sm text-gray-500">Visa: 10.1-10.5 | Mastercard: 4837, 4863 | ELO: 401-403</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-700">35%</p>
                        <p class="text-xs text-gray-500">of disputes</p>
                    </div>
                </div>
                <!-- Friendly Fraud - Revealed on Segment 5 when Alex says "the controversial third type: Friendly Fraud" -->
                <div class="bg-white p-6 rounded-lg shadow-md flex items-start gap-6 slide-card" data-reveal-segment="5" data-highlight-segment="6">
                    <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="font-semibold text-xl">Friendly Fraud</h3>
                            <span class="text-xs font-medium px-2 py-0.5 bg-amber-100 text-amber-700 rounded">Challenging</span>
                        </div>
                        <p class="text-gray-600 mb-3">Cardholder made purchase but disputes it. Buyer's remorse or deliberate abuse.</p>
                        <p class="text-sm text-gray-500">Same codes as merchant error - requires careful evidence review</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-700">20%</p>
                        <p class="text-xs text-gray-500">of disputes</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 4: PRIMITIVE State Machine -->
    <section class="slide flex-col items-center justify-center p-8 relative" data-slide-id="slide-4">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 4 of 18</div>
        <div class="max-w-6xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-4 slide-title">The PRIMITIVE State Machine</h2>
            <p class="text-xl text-gray-600 mb-8 slide-subtitle">Pismo's core architecture for dispute workflows</p>
            <div class="bg-white p-8 rounded-lg shadow-md">
                <div id="state-machine-d3" class="w-full" style="height: 420px;"></div>
            </div>
        </div>
    </section>

    <!-- Slide 5: State Groups -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 5 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-4 slide-title">State Groups Deep Dive</h2>
            <p class="text-xl text-gray-600 mb-8 slide-subtitle">Understanding the six state categories</p>
            <!-- Slide 5 reveals match script: Seg1=OPEN, Seg2=CHARGEBACK, Seg3=SECOND_PRESENTMENT, Seg4=PREARBITRATION, Seg5=terminal states -->
            <div class="grid grid-cols-2 gap-4">
                <!-- Seg 1: Alex says "OPEN is where everything begins" -->
                <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 border-l-4 border-l-blue-500 slide-card" data-reveal-segment="1">
                    <h3 class="font-semibold text-lg mb-2 text-blue-600">OPEN</h3>
                    <p class="text-sm text-gray-600 mb-3">Initial dispute state</p>
                    <span class="inline-block px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded">PENDING</span>
                </div>
                <!-- Seg 2: Jordan says "CARDNETWORK_CHARGEBACK is the active phase" -->
                <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 border-l-4 border-l-amber-500 slide-card" data-reveal-segment="2">
                    <h3 class="font-semibold text-lg mb-2 text-amber-600">CARDNETWORK_CHARGEBACK</h3>
                    <p class="text-sm text-gray-600 mb-3">Active with card network</p>
                    <div class="flex flex-wrap gap-1">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">OPENED</span>
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">CHARGEBACK_CREATED</span>
                    </div>
                </div>
                <!-- Seg 3: Alex says "CARDNETWORK_SECOND_PRESENTMENT kicks in when the acquirer fights back" -->
                <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 border-l-4 border-l-purple-500 slide-card" data-reveal-segment="3">
                    <h3 class="font-semibold text-lg mb-2 text-purple-600">SECOND_PRESENTMENT</h3>
                    <p class="text-sm text-gray-600 mb-3">Acquirer contests chargeback</p>
                    <div class="flex flex-wrap gap-1">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">SECOND_PRESENTMENT</span>
                    </div>
                </div>
                <!-- Seg 4: Jordan says "CARDNETWORK_PREARBITRATION is the escalation zone" -->
                <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 border-l-4 border-l-indigo-500 slide-card" data-reveal-segment="4">
                    <h3 class="font-semibold text-lg mb-2 text-indigo-600">PREARBITRATION</h3>
                    <p class="text-sm text-gray-600 mb-3">Network makes final call</p>
                    <div class="flex flex-wrap gap-1">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">PRE_ARB_OPENED</span>
                    </div>
                </div>
                <!-- Seg 5: Alex says "DENIED means canceled. FAILED means something went wrong. LOSS means the issuer lost. And WON means party time" -->
                <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 border-l-4 border-l-slate-500 slide-card" data-reveal-segment="5">
                    <h3 class="font-semibold text-lg mb-2 text-slate-600">DENIED / FAILED</h3>
                    <p class="text-sm text-gray-600 mb-3">Canceled or processing failures</p>
                    <div class="flex flex-wrap gap-1">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">CANCELED</span>
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">FAILED</span>
                    </div>
                </div>
                <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 border-l-4 border-l-red-500 slide-card" data-reveal-segment="5">
                    <h3 class="font-semibold text-lg mb-2 text-red-600">LOSS</h3>
                    <p class="text-sm text-gray-600 mb-3">Issuer loses dispute</p>
                    <div class="flex flex-wrap gap-1">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">EXPIRED</span>
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">REJECTED</span>
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">DECLINED</span>
                    </div>
                </div>
                <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 border-l-4 border-l-green-500 slide-card col-span-2" data-reveal-segment="5" data-highlight-segment="6">
                    <h3 class="font-semibold text-lg mb-2 text-green-600">WON</h3>
                    <p class="text-sm text-gray-600 mb-3">Issuer wins dispute - party time!</p>
                    <div class="flex flex-wrap gap-1">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">CHARGEBACK_ACCEPTED</span>
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">PRE_ARB_ACCEPTED</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 6: Core Workflow -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 6 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-4 slide-title">Core Workflow Overview</h2>
            <p class="text-xl text-gray-600 mb-10 slide-subtitle">The journey of a dispute</p>
            <div class="flex items-center justify-between mb-8">
                <div class="flex flex-col items-center slide-card">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    </div>
                    <p class="font-medium">Cardholder</p>
                    <p class="text-xs text-gray-500">Reports issue</p>
                </div>
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                <div class="flex flex-col items-center slide-card">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    </div>
                    <p class="font-medium">Issuer</p>
                    <p class="text-xs text-gray-500">Creates dispute</p>
                </div>
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                <div class="flex flex-col items-center slide-card">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                    </div>
                    <p class="font-medium">Card Network</p>
                    <p class="text-xs text-gray-500">Processes claim</p>
                </div>
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                <div class="flex flex-col items-center slide-card">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <p class="font-medium">Resolution</p>
                    <p class="text-xs text-gray-500">Win or Loss</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="font-semibold mb-4 text-blue-600">Key Deadlines</h3>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                        <p class="text-2xl font-bold text-blue-600">5-7</p>
                        <p class="text-sm text-gray-600">days for network response</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                        <p class="text-2xl font-bold text-blue-600">30-45</p>
                        <p class="text-sm text-gray-600">days for second presentment</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                        <p class="text-2xl font-bold text-blue-600">30-45</p>
                        <p class="text-sm text-gray-600">days for pre-arbitration</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 7: Creating a Dispute (Mockup) -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 7 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Step 1: Creating a Dispute</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">POST /disputes - Status: PENDING</p>
            <!-- Slide 7: Seg2=mockup dialog, Seg3=API code, Seg3=response, Seg6=next steps -->
            <div class="grid grid-cols-2 gap-6">
                <!-- Mockup - Seg 2: Jordan says "this is our Dispute Creation Dialog" -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card" data-reveal-segment="2" data-highlight-segment="4">
                    <div class="bg-gray-100 px-4 py-3 border-b flex items-center justify-between">
                        <h3 class="font-semibold">Create New Dispute</h3>
                        <button class="text-gray-400 hover:text-gray-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Transaction ID</label>
                            <input type="text" value="TXN-2024-00847291" class="w-full px-3 py-2 border rounded-md bg-gray-50" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Dispute Type</label>
                            <select class="w-full px-3 py-2 border rounded-md">
                                <option>Fraud - Card Not Present</option>
                                <option>Merchant Error</option>
                                <option>Consumer Dispute</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Reason Code</label>
                            <select class="w-full px-3 py-2 border rounded-md">
                                <option>10.4 - Other Fraud (CNP)</option>
                                <option>13.1 - Merchandise Not Received</option>
                                <option>13.6 - Credit Not Processed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Disputed Amount</label>
                            <div class="flex">
                                <span class="px-3 py-2 bg-gray-100 border border-r-0 rounded-l-md text-gray-500">$</span>
                                <input type="text" value="249.99" class="flex-1 px-3 py-2 border rounded-r-md">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Cardholder Statement</label>
                            <textarea class="w-full px-3 py-2 border rounded-md h-20" placeholder="Enter cardholder's description of the issue..."></textarea>
                        </div>
                        <div class="flex gap-3 pt-2">
                            <button class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">Cancel</button>
                            <button class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Create Dispute</button>
                        </div>
                    </div>
                </div>
                <!-- API Info -->
                <div class="space-y-4">
                    <!-- Seg 1: Alex says "Creating a dispute starts with a POST request" -->
                    <div class="bg-gray-900 text-gray-100 p-4 rounded-lg text-sm font-mono slide-card" data-reveal-segment="1">
                        <p class="text-gray-500 mb-2">//POST /disputes</p>
                        <pre class="text-xs">{
  "transaction_id": "TXN-2024-00847291",
  "reason_code": "10.4",
  "amount": 249.99,
  "currency": "USD",
  "cardholder_statement": "..."
}</pre>
                    </div>
                    <!-- Seg 3: Alex says "Once the API returns successfully, dispute lands in PENDING" -->
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 slide-card" data-reveal-segment="3">
                        <h4 class="font-semibold text-gray-900 mb-2">Response</h4>
                        <p class="text-sm text-gray-700">Status: <span class="font-mono bg-gray-100 px-2 py-0.5 rounded">PENDING</span></p>
                        <p class="text-sm text-gray-700 mt-1">Dispute ID: <span class="font-mono">DSP-2024-00001234</span></p>
                    </div>
                    <!-- Seg 6: Jordan says "We also show a What's Next panel" -->
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 slide-card" data-reveal-segment="6">
                        <h4 class="font-semibold text-gray-900 mb-2">Next Steps</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>1. Upload supporting evidence</li>
                            <li>2. Submit network forms (if required)</li>
                            <li>3. Open dispute to submit to network</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 8: Evidence Upload (Mockup) -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 8 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Step 2: Uploading Evidence</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">POST /disputes/{`{id}`}/files</p>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card" data-reveal-segment="1">
                <div class="bg-gray-100 px-6 py-4 border-b">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-semibold">Dispute Evidence</h3>
                            <p class="text-sm text-gray-500">DSP-2024-00001234</p>
                        </div>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 text-sm font-medium rounded">PENDING</span>
                    </div>
                </div>
                <div class="p-6">
                    <div class="dropzone rounded-lg p-8 text-center mb-6">
                        <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                        <p class="text-gray-600 mb-2">Drag and drop files here, or <span class="text-gray-700 cursor-pointer hover:text-gray-900">browse</span></p>
                        <p class="text-xs text-gray-400">PDF, JPG, PNG up to 10MB each</p>
                    </div>
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-sm text-gray-500 border-b">
                                <th class="pb-3 font-medium">Document</th>
                                <th class="pb-3 font-medium">Type</th>
                                <th class="pb-3 font-medium">Size</th>
                                <th class="pb-3 font-medium">Status</th>
                                <th class="pb-3 font-medium"></th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr class="border-b">
                                <td class="py-3 flex items-center gap-2">
                                    <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/></svg>
                                    cardholder_statement.pdf
                                </td>
                                <td class="py-3"><span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">Statement</span></td>
                                <td class="py-3 text-gray-500">245 KB</td>
                                <td class="py-3"><span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded">Uploaded</span></td>
                                <td class="py-3 text-gray-400 cursor-pointer hover:text-gray-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                                </td>
                            </tr>
                            <tr class="border-b">
                                <td class="py-3 flex items-center gap-2">
                                    <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/></svg>
                                    transaction_screenshot.png
                                </td>
                                <td class="py-3"><span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">Evidence</span></td>
                                <td class="py-3 text-gray-500">1.2 MB</td>
                                <td class="py-3"><span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded">Uploaded</span></td>
                                <td class="py-3 text-gray-400 cursor-pointer hover:text-gray-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                                </td>
                            </tr>
                            <tr>
                                <td class="py-3 flex items-center gap-2">
                                    <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/></svg>
                                    police_report.pdf
                                </td>
                                <td class="py-3"><span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">Legal</span></td>
                                <td class="py-3 text-gray-500">892 KB</td>
                                <td class="py-3"><span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded">Processing</span></td>
                                <td class="py-3 text-gray-400">
                                    <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 9: Status Dashboard (Mockup) -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 9 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Step 3: Opening the Dispute</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">PENDING to OPENED transition</p>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card">
                <div class="bg-gray-100 px-6 py-4 border-b">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <h3 class="font-semibold text-lg">DSP-2024-00001234</h3>
                            <span class="px-3 py-1 bg-blue-100 text-blue-700 text-sm font-medium rounded">OPENED</span>
                        </div>
                        <div class="flex gap-2">
                            <button class="px-3 py-1.5 text-sm border rounded-md hover:bg-gray-50">Export</button>
                            <button class="px-3 py-1.5 text-sm bg-gray-50 text-gray-700 border border-gray-200 rounded-md hover:bg-gray-100">Cancel Dispute</button>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-4 gap-4 mb-6">
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Amount</p>
                            <p class="text-xl font-bold">$249.99</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Reason Code</p>
                            <p class="text-xl font-bold">10.4</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Network</p>
                            <p class="text-xl font-bold">Visa</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Created</p>
                            <p class="text-xl font-bold">Jan 15</p>
                        </div>
                    </div>
                    <!-- Timeline -->
                    <h4 class="font-semibold mb-4">Dispute Timeline</h4>
                    <div class="relative">
                        <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                        <div class="space-y-6">
                            <div class="flex gap-4 relative">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center z-10">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                                </div>
                                <div class="flex-1 pb-2">
                                    <p class="font-medium">Dispute Created</p>
                                    <p class="text-sm text-gray-500">Jan 15, 2024 at 10:32 AM</p>
                                </div>
                            </div>
                            <div class="flex gap-4 relative">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center z-10">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                                </div>
                                <div class="flex-1 pb-2">
                                    <p class="font-medium">Evidence Uploaded</p>
                                    <p class="text-sm text-gray-500">Jan 15, 2024 at 10:45 AM - 3 files</p>
                                </div>
                            </div>
                            <div class="flex gap-4 relative">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center z-10">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
                                </div>
                                <div class="flex-1 pb-2">
                                    <p class="font-medium">Submitted to Visa</p>
                                    <p class="text-sm text-gray-500">Jan 15, 2024 at 11:00 AM</p>
                                </div>
                            </div>
                            <div class="flex gap-4 relative">
                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center z-10">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium text-gray-400">Awaiting Network Response</p>
                                    <p class="text-sm text-gray-400">Expected by Jan 22, 2024</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 10: Chargeback Created (Mockup) -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 10 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Step 4: Chargeback Created</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">Network accepts the dispute</p>
            <div class="grid grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card">
                    <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">Chargeback Accepted</h3>
                                <p class="text-sm text-gray-600">Visa has accepted your dispute</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Chargeback ID</span>
                                <span class="font-mono">CB-2024-00789456</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Status</span>
                                <span class="px-2 py-1 bg-amber-100 text-amber-700 text-sm rounded">CHARGEBACK_CREATED</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Provisional Credit</span>
                                <span class="font-semibold text-gray-900">$249.99</span>
                            </div>
                            <div class="flex justify-between py-2">
                                <span class="text-gray-500">Response Deadline</span>
                                <span class="font-medium">Feb 14, 2024</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="bg-gray-50 p-5 rounded-lg border border-gray-200 slide-card">
                        <h4 class="font-semibold text-gray-900 mb-3">What Happens Next?</h4>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li class="flex items-start gap-2">
                                <span class="text-gray-600 mt-0.5">1.</span>
                                <span>Acquirer notifies merchant of chargeback</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-gray-600 mt-0.5">2.</span>
                                <span>Merchant has 30 days to respond</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-gray-600 mt-0.5">3.</span>
                                <span>If no response: <strong>CHARGEBACK_ACCEPTED</strong> (you win!)</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-gray-600 mt-0.5">4.</span>
                                <span>If contested: <strong>SECOND_PRESENTMENT</strong></span>
                            </li>
                        </ul>
                    </div>
                    <div class="bg-gray-900 text-gray-100 p-4 rounded-lg text-sm font-mono slide-card">
                        <p class="text-gray-500 mb-2">//Webhook: dispute.status.changed</p>
                        <pre class="text-xs">{
  "dispute_id": "DSP-2024-00001234",
  "previous_status": "OPENED",
  "new_status": "CHARGEBACK_CREATED",
  "chargeback_id": "CB-2024-00789456"
}</pre>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 11: Second Presentment (Mockup) -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 11 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Step 5: Second Presentment</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">Merchant contests the chargeback</p>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card" data-reveal-segment="1" data-highlight-segment="2">
                <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">Action Required</h3>
                                <p class="text-sm text-gray-600">Merchant has contested the chargeback</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-600">Deadline</p>
                            <p class="text-2xl font-bold text-gray-900">23 days</p>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold mb-3">Merchant's Evidence</h4>
                            <div class="space-y-2">
                                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                                    <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/></svg>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium">delivery_confirmation.pdf</p>
                                        <p class="text-xs text-gray-500">Proof of delivery</p>
                                    </div>
                                    <button class="text-gray-700 text-sm hover:underline">View</button>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                                    <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/></svg>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium">signature_capture.png</p>
                                        <p class="text-xs text-gray-500">Customer signature</p>
                                    </div>
                                    <button class="text-gray-700 text-sm hover:underline">View</button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-3">Your Options</h4>
                            <div class="space-y-3">
                                <button class="w-full p-4 border-2 border-gray-300 rounded-lg text-left hover:border-gray-400 hover:bg-gray-50 transition">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                                            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">Escalate to Pre-Arbitration</p>
                                            <p class="text-xs text-gray-500">Continue fighting the dispute</p>
                                        </div>
                                    </div>
                                </button>
                                <button class="w-full p-4 border-2 border-gray-200 rounded-lg text-left hover:border-gray-400 hover:bg-gray-50 transition">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                                            <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-800">Accept Loss</p>
                                            <p class="text-xs text-gray-500">Close the dispute as ISSUER_LOSS</p>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 12: Pre-Arbitration (Mockup) -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 12 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Step 6: Pre-Arbitration</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">Escalation for final resolution</p>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card">
                <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900">Pre-Arbitration Submission</h3>
                        <div class="flex items-center gap-2">
                            <div class="flex gap-1">
                                <div class="w-8 h-2 bg-gray-400 rounded-full"></div>
                                <div class="w-8 h-2 bg-gray-400 rounded-full"></div>
                                <div class="w-8 h-2 bg-gray-200 rounded-full"></div>
                            </div>
                            <span class="text-sm text-gray-600">Step 2 of 3</span>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-3 gap-6">
                        <div class="col-span-2 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Reason for Escalation</label>
                                <select class="w-full px-3 py-2 border rounded-md">
                                    <option>Merchant evidence is insufficient</option>
                                    <option>New evidence available</option>
                                    <option>Procedural violation by acquirer</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Additional Statement</label>
                                <textarea class="w-full px-3 py-2 border rounded-md h-24" placeholder="Provide additional context for the pre-arbitration case..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Supporting Evidence</label>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" checked class="rounded text-gray-600">
                                            <span class="text-sm">cardholder_statement.pdf</span>
                                        </div>
                                        <span class="text-xs text-gray-500">Original</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" checked class="rounded text-gray-600">
                                            <span class="text-sm">transaction_screenshot.png</span>
                                        </div>
                                        <span class="text-xs text-gray-500">Original</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" checked class="rounded text-gray-600">
                                            <span class="text-sm font-medium text-gray-900">ip_geolocation_report.pdf</span>
                                        </div>
                                        <span class="text-xs px-1 py-0.5 bg-green-100 text-green-600 rounded">New</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <h4 class="font-semibold text-sm mb-2">Case Summary</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Amount</span>
                                        <span class="font-medium">$249.99</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Reason</span>
                                        <span class="font-medium">10.4</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-500">Days in Dispute</span>
                                        <span class="font-medium">34</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <p class="text-xs text-gray-700"><strong>Note:</strong> Pre-arbitration is typically the final step. Network decision is binding.</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between mt-6 pt-4 border-t">
                        <button class="px-4 py-2 text-gray-600 hover:text-gray-800">Back</button>
                        <div class="flex gap-3">
                            <button class="px-4 py-2 border rounded-md hover:bg-gray-50">Save Draft</button>
                            <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Submit to Network</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 13: Resolution Summary (Mockup) -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 13 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Resolution States</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">Final outcomes and financial impact</p>
            <!-- Slide 13: Seg2=WIN card (Alex talks about winning), Seg4=LOSS card (Alex talks about losing) -->
            <div class="grid grid-cols-2 gap-6">
                <!-- WIN - Seg 2: Alex says "Winning lands you in CHARGEBACK_ACCEPTED..." -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card" data-reveal-segment="2" data-highlight-segment="3">
                    <div class="bg-green-600 px-6 py-4">
                        <div class="flex items-center gap-3">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <div>
                                <h3 class="font-bold text-white text-xl">DISPUTE WON</h3>
                                <p class="text-green-100 text-sm">PRE_ARBITRATION_ACCEPTED</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Dispute ID</span>
                                <span class="font-mono">DSP-2024-00001234</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Duration</span>
                                <span>45 days</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Amount Recovered</span>
                                <span class="text-xl font-bold text-green-600">$249.99</span>
                            </div>
                            <div class="flex justify-between py-2">
                                <span class="text-gray-500">Credit Status</span>
                                <span class="px-2 py-1 bg-green-100 text-green-700 text-sm rounded">Permanent</span>
                            </div>
                        </div>
                        <div class="mt-4 p-4 bg-green-50 rounded-lg">
                            <p class="text-sm text-green-700">Cardholder credit is now permanent. Merchant bears the loss.</p>
                        </div>
                    </div>
                </div>
                <!-- LOSS -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden slide-card" data-reveal-segment="4" data-highlight-segment="5">
                    <div class="bg-red-600 px-6 py-4">
                        <div class="flex items-center gap-3">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <div>
                                <h3 class="font-bold text-white text-xl">DISPUTE LOST</h3>
                                <p class="text-red-100 text-sm">PRE_ARBITRATION_DECLINED</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Dispute ID</span>
                                <span class="font-mono">DSP-2024-00005678</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Duration</span>
                                <span>52 days</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-500">Amount Lost</span>
                                <span class="text-xl font-bold text-red-600">$189.00</span>
                            </div>
                            <div class="flex justify-between py-2">
                                <span class="text-gray-500">Credit Status</span>
                                <span class="px-2 py-1 bg-red-100 text-red-700 text-sm rounded">Reversed</span>
                            </div>
                        </div>
                        <div class="mt-4 p-4 bg-red-50 rounded-lg">
                            <p class="text-sm text-red-700">Provisional credit reversed. Cardholder account debited.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 14: Visa Workflow -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 14 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Visa Workflow</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">Collaboration and Allocation forms</p>
            <!-- Slide 14: Seg2=Visa requirements card, Seg5=API endpoints, Seg5=allocation path -->
            <div class="grid grid-cols-3 gap-6">
                <!-- Seg 2: Jordan says "Visa uses Collaboration questionnaires..." -->
                <div class="col-span-2 bg-white rounded-lg shadow-md p-6 slide-card" data-reveal-segment="2" data-highlight-segment="4">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-blue-600 text-white rounded flex items-center justify-center text-sm font-bold">V</span>
                        Visa-Specific Requirements
                    </h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-medium text-blue-800 mb-2">Collaboration Questionnaire</h4>
                            <p class="text-sm text-blue-700">Required for consumer disputes (13.x codes). Network uses responses to route the dispute.</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-medium text-blue-800 mb-2">Allocation Questionnaire</h4>
                            <p class="text-sm text-blue-700">Used for fraud disputes. Can bypass second presentment and go directly to pre-arbitration.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-medium mb-2">Key Reason Codes</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div><span class="font-mono bg-gray-200 px-1 rounded">10.4</span> CNP Fraud</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">13.1</span> Not Received</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">13.3</span> Not as Described</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">13.6</span> Credit Not Processed</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="bg-white rounded-lg shadow-md p-4 slide-card" data-reveal-segment="5" data-highlight-segment="6">
                        <h4 class="font-semibold text-sm mb-3">API Endpoints</h4>
                        <div class="space-y-2 text-xs font-mono">
                            <p class="p-2 bg-gray-100 rounded">POST /disputes/{`{id}`}/forms</p>
                            <p class="p-2 bg-gray-100 rounded">GET /disputes/{`{id}`}/forms</p>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 border border-blue-200 slide-card" data-reveal-segment="6">
                        <h4 class="font-semibold text-blue-800 text-sm mb-2">Visa Allocation Path</h4>
                        <p class="text-xs text-blue-700">PRE_ARB_ALLOCATION_OPENED state bypasses second presentment entirely.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 15: Mastercard Workflow -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 15 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Mastercard Workflow</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">EBDF forms and TQR4 reports</p>
            <!-- Slide 15: Seg1=EBDF mention, Seg3=TQR4, Seg5=linear flow, Seg7=fees -->
            <div class="grid grid-cols-3 gap-6">
                <!-- Seg 1: Alex says "The big difference is the EBDF form" -->
                <div class="col-span-2 bg-white rounded-lg shadow-md p-6 slide-card" data-reveal-segment="1">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-red-500 text-white rounded flex items-center justify-center text-sm font-bold">M</span>
                        Mastercard-Specific Requirements
                    </h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                            <h4 class="font-medium text-red-800 mb-2">EBDF (Electronic Batch Dispute File)</h4>
                            <p class="text-sm text-red-700">Standardized form required for all Mastercard disputes. Contains transaction details and dispute reason.</p>
                        </div>
                        <div class="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-500">
                            <h4 class="font-medium text-orange-800 mb-2">TQR4 Reconciliation Reports</h4>
                            <p class="text-sm text-orange-700">Daily settlement reports showing dispute status and financial movements.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-medium mb-2">Key Reason Codes</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div><span class="font-mono bg-gray-200 px-1 rounded">4837</span> No Cardholder Auth</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">4853</span> Cardholder Dispute</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">4855</span> Not Provided</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">4863</span> Unrecognized</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <!-- Seg 7: Alex says "Watch for dispute fees" -->
                    <div class="bg-white rounded-lg shadow-md p-4 slide-card" data-reveal-segment="7">
                        <h4 class="font-semibold text-sm mb-3">Dispute Fees</h4>
                        <p class="text-xs text-gray-600 mb-2">Mastercard charges fees outside the chargeback flow:</p>
                        <ul class="text-xs text-gray-500 space-y-1">
                            <li>- Filing fee: $15-25</li>
                            <li>- Pre-arb fee: $50-100</li>
                            <li>- Arbitration: $250-500</li>
                        </ul>
                    </div>
                    <!-- Seg 5: Alex says "Mastercard's process is more linear" -->
                    <div class="bg-red-50 rounded-lg p-4 border border-red-200 slide-card" data-reveal-segment="5">
                        <h4 class="font-semibold text-red-800 text-sm mb-2">Standard Flow</h4>
                        <p class="text-xs text-red-700">No allocation bypass. All contested chargebacks go through second presentment.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 16: ELO Workflow -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 16 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">ELO Workflow</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">Portal uploads and LATAM considerations</p>
            <!-- Slide 16: Seg1=intro, Seg2=portal manual uploads, Seg5=warning banners, Seg7=Portuguese -->
            <div class="grid grid-cols-3 gap-6">
                <!-- Seg 2: Alex says "evidence uploads go through ELO's portal manually" -->
                <div class="col-span-2 bg-white rounded-lg shadow-md p-6 slide-card" data-reveal-segment="2">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-gray-700 text-white rounded flex items-center justify-center text-sm font-bold">E</span>
                        ELO-Specific Requirements
                    </h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-gray-50 rounded-lg border-l-4 border-gray-300">
                            <h4 class="font-medium text-gray-900 mb-2">Manual Portal Upload</h4>
                            <p class="text-sm text-gray-700">Evidence must be uploaded directly to ELO's portal - not via Pismo API. This is a critical workflow difference.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg border-l-4 border-gray-300">
                            <h4 class="font-medium text-gray-900 mb-2">Brazil/LATAM Focus</h4>
                            <p class="text-sm text-gray-700">ELO is primarily used in Brazil. Consider Portuguese language support and local compliance requirements.</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-medium mb-2">Key Reason Codes</h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div><span class="font-mono bg-gray-200 px-1 rounded">101</span> Not Authorized</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">201</span> Duplicate</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">301</span> Not Received</div>
                                <div><span class="font-mono bg-gray-200 px-1 rounded">401</span> CNP Fraud</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <!-- Seg 5: Jordan says "We use warning banners and confirmations" -->
                    <div class="bg-white rounded-lg shadow-md p-4 slide-card" data-reveal-segment="5">
                        <h4 class="font-semibold text-sm mb-3">Integration Note</h4>
                        <p class="text-xs text-gray-600">Your UI should indicate when manual portal upload is required and provide a link to ELO's portal.</p>
                    </div>
                    <!-- Seg 7: Jordan says "consider Portuguese language support" -->
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 slide-card" data-reveal-segment="7">
                        <h4 class="font-semibold text-gray-900 text-sm mb-2">Custom Messaging</h4>
                        <p class="text-xs text-gray-700">ELO dispute codes include custom messaging fields. Display these to operators.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 17: Building Your Dialogs -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 17 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-2 slide-title">Building Your Dialogs</h2>
            <p class="text-xl text-gray-600 mb-6 slide-subtitle">UI patterns and Shadcn components</p>
            <!-- Slide 17: Seg2=components, Seg4=form requirements, Seg6=code sample -->
            <div class="grid grid-cols-2 gap-6">
                <div class="space-y-4">
                    <!-- Seg 2: Alex says "Your dialogs need to be state-aware", Seg 3: Jordan lists components -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="2" data-highlight-segment="3">
                        <h3 class="font-semibold mb-3">Recommended Components</h3>
                        <div class="space-y-2">
                            <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                <span class="w-6 h-6 bg-blue-100 rounded flex items-center justify-center text-xs text-blue-600 font-medium">D</span>
                                <span class="text-sm"><strong>Dialog</strong> - Create/Edit forms</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                <span class="w-6 h-6 bg-green-100 rounded flex items-center justify-center text-xs text-green-600 font-medium">C</span>
                                <span class="text-sm"><strong>Card</strong> - Status display, summaries</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                <span class="w-6 h-6 bg-amber-100 rounded flex items-center justify-center text-xs text-amber-600 font-medium">A</span>
                                <span class="text-sm"><strong>Alert</strong> - Deadlines, warnings</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                <span class="w-6 h-6 bg-purple-100 rounded flex items-center justify-center text-xs text-purple-600 font-medium">B</span>
                                <span class="text-sm"><strong>Badge</strong> - Status indicators</span>
                            </div>
                            <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                <span class="w-6 h-6 bg-red-100 rounded flex items-center justify-center text-xs text-red-600 font-medium">T</span>
                                <span class="text-sm"><strong>Table</strong> - Evidence lists, history</span>
                            </div>
                        </div>
                    </div>
                    <!-- Seg 4: Alex says "For timeline visualization, map to state groups" -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="4" data-highlight-segment="5">
                        <h3 class="font-semibold mb-3">Form Requirements by State</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between p-2 border-b">
                                <span>PENDING</span>
                                <span class="text-gray-500">Create form, reason selector</span>
                            </div>
                            <div class="flex justify-between p-2 border-b">
                                <span>OPENED</span>
                                <span class="text-gray-500">Status display, cancel button</span>
                            </div>
                            <div class="flex justify-between p-2 border-b">
                                <span>SECOND_PRESENTMENT</span>
                                <span class="text-gray-500">Deadline alert, action buttons</span>
                            </div>
                            <div class="flex justify-between p-2">
                                <span>PRE_ARBITRATION</span>
                                <span class="text-gray-500">Multi-step wizard, evidence</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <!-- Seg 6: Alex says "Form validation is critical" - reveal code sample -->
                    <div class="bg-gray-900 text-gray-100 p-5 rounded-lg slide-card" data-reveal-segment="6" data-highlight-segment="7">
                        <h3 class="font-semibold mb-3 text-white">State-Based Rendering</h3>
                        <pre class="text-xs overflow-x-auto"><code class="text-green-400">// React pattern for state-based UI
const DisputeDialog = ({ dispute }) => {
  switch (dispute.status) {
    case 'PENDING':
      return &lt;CreateDisputeForm /&gt;;
    case 'OPENED':
      return &lt;StatusDashboard /&gt;;
    case 'SECOND_PRESENTMENT':
      return &lt;SecondPresentmentAlert /&gt;;
    case 'PRE_ARBITRATION_OPENED':
      return &lt;PreArbWizard /&gt;;
    default:
      return &lt;ResolutionSummary /&gt;;
  }
};</code></pre>
                    </div>
                    <div class="bg-gray-50 p-5 rounded-lg border border-gray-200 slide-card">
                        <h3 class="font-semibold text-gray-900 mb-2">Key UX Principles</h3>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>- Always show current state prominently</li>
                            <li>- Display deadlines with countdown</li>
                            <li>- Make available actions obvious</li>
                            <li>- Show financial impact clearly</li>
                            <li>- Provide clear next steps</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Slide 18: Key Takeaways -->
    <section class="slide flex-col items-center justify-center p-8 relative">
        <div class="absolute top-4 left-4 text-sm text-gray-400 font-medium slide-number">Slide 18 of 18</div>
        <div class="max-w-5xl w-full">
            <h2 class="text-4xl font-bold text-gray-900 mb-4 slide-title">Key Takeaways</h2>
            <p class="text-xl text-gray-600 mb-8 slide-subtitle">Summary and next steps</p>
            <!-- Slide 18: Seg1=just title, Seg2=state machine, Seg3=network, Seg4=evidence, Seg5=deadlines, Seg6=lifecycle, Seg7=docs, Seg8=resources -->
            <div class="grid grid-cols-2 gap-6 mb-8">
                <div class="space-y-4">
                    <!-- Seg 2: Jordan says "First, understand the state machine" -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="2">
                        <h3 class="font-semibold mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center text-xs">1</span>
                            PRIMITIVE State Machine
                        </h3>
                        <p class="text-sm text-gray-600">Master the 6 state groups: OPEN, CARDNETWORK_CHARGEBACK, WON, LOSS, DENIED, FAILED</p>
                    </div>
                    <!-- Seg 3: Alex says "Second, network differences matter" -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="3">
                        <h3 class="font-semibold mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center text-xs">2</span>
                            Network Differences
                        </h3>
                        <p class="text-sm text-gray-600">Visa: Collaboration/Allocation forms. Mastercard: EBDF. ELO: Portal uploads.</p>
                    </div>
                    <!-- Seg 4: Jordan says "Third, evidence is everything" -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="4">
                        <h3 class="font-semibold mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center text-xs">3</span>
                            Evidence Is Key
                        </h3>
                        <p class="text-sm text-gray-600">Strong evidence uploads increase win rates. Make file uploads prominent and easy.</p>
                    </div>
                </div>
                <div class="space-y-4">
                    <!-- Seg 5: Alex says "Fourth, deadlines are critical" -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="5">
                        <h3 class="font-semibold mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center text-xs">4</span>
                            Deadlines Are Critical
                        </h3>
                        <p class="text-sm text-gray-600">Missing a deadline = automatic EXPIRED status (issuer loss). Always display countdowns.</p>
                    </div>
                    <!-- Seg 6: Jordan says "Fifth, design for the full lifecycle" -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="6">
                        <h3 class="font-semibold mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center text-xs">5</span>
                            Design for Full Lifecycle
                        </h3>
                        <p class="text-sm text-gray-600">Disputes take months. Tell the complete story. Guide users through each phase.</p>
                    </div>
                    <!-- Seg 7: Alex says "Check the Pismo developer docs" -->
                    <div class="bg-white rounded-lg shadow-md p-5 slide-card" data-reveal-segment="7">
                        <h3 class="font-semibold mb-3 flex items-center gap-2">
                            <span class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center text-xs">6</span>
                            Use Developer Docs
                        </h3>
                        <p class="text-sm text-gray-600">Check Pismo developer docs. State machine reference and disputes overview are essential.</p>
                    </div>
                </div>
            </div>
            <!-- Seg 7: Reveal together with the 6th takeaway card -->
            <div class="bg-gray-700 text-white p-6 rounded-lg slide-card" data-reveal-segment="7">
                <h3 class="font-semibold text-lg mb-4">Resources</h3>
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <div>
                        <p class="text-gray-200 mb-1">API Documentation</p>
                        <p class="font-mono text-xs">developers.pismo.io/disputes</p>
                    </div>
                    <div>
                        <p class="text-gray-200 mb-1">State Machine Docs</p>
                        <p class="font-mono text-xs">pismo-docs/disputes-state-machine</p>
                    </div>
                    <div>
                        <p class="text-gray-200 mb-1">Support</p>
                        <p class="font-mono text-xs">support@pismo.io</p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-8">
                <p class="text-gray-500">Thank you for attending!</p>
            </div>
        </div>
    </section>

    <script>
        // Audio segments for each slide (1-indexed slide numbers)
        const slideAudio = {
            1: ['slide01_alex_01.mp3', 'slide01_jordan_02.mp3', 'slide01_alex_03.mp3', 'slide01_jordan_04.mp3'],
            2: ['slide02_jordan_01.mp3', 'slide02_alex_02.mp3', 'slide02_jordan_03.mp3', 'slide02_alex_04.mp3', 'slide02_jordan_05.mp3'],
            3: ['slide03_alex_01.mp3', 'slide03_jordan_02.mp3', 'slide03_alex_03.mp3', 'slide03_jordan_04.mp3', 'slide03_alex_05.mp3', 'slide03_jordan_06.mp3'],
            4: ['slide04_alex_01.mp3', 'slide04_jordan_02.mp3', 'slide04_alex_03.mp3', 'slide04_jordan_04.mp3', 'slide04_alex_05.mp3'],
            5: ['slide05_alex_01.mp3', 'slide05_jordan_02.mp3', 'slide05_alex_03.mp3', 'slide05_jordan_04.mp3', 'slide05_alex_05.mp3', 'slide05_jordan_06.mp3'],
            6: ['slide06_jordan_01.mp3', 'slide06_alex_02.mp3', 'slide06_jordan_03.mp3', 'slide06_alex_04.mp3', 'slide06_jordan_05.mp3', 'slide06_alex_06.mp3'],
            7: ['slide07_alex_01.mp3', 'slide07_jordan_02.mp3', 'slide07_alex_03.mp3', 'slide07_jordan_04.mp3', 'slide07_alex_05.mp3', 'slide07_jordan_06.mp3'],
            8: ['slide08_jordan_01.mp3', 'slide08_alex_02.mp3', 'slide08_jordan_03.mp3', 'slide08_alex_04.mp3', 'slide08_jordan_05.mp3', 'slide08_alex_06.mp3'],
            9: ['slide09_alex_01.mp3', 'slide09_jordan_02.mp3', 'slide09_alex_03.mp3', 'slide09_jordan_04.mp3', 'slide09_alex_05.mp3', 'slide09_jordan_06.mp3'],
            10: ['slide10_jordan_01.mp3', 'slide10_alex_02.mp3', 'slide10_jordan_03.mp3', 'slide10_alex_04.mp3', 'slide10_jordan_05.mp3', 'slide10_alex_06.mp3'],
            11: ['slide11_alex_01.mp3', 'slide11_jordan_02.mp3', 'slide11_alex_03.mp3', 'slide11_jordan_04.mp3', 'slide11_alex_05.mp3', 'slide11_jordan_06.mp3'],
            12: ['slide12_alex_01.mp3', 'slide12_jordan_02.mp3', 'slide12_alex_03.mp3', 'slide12_jordan_04.mp3', 'slide12_alex_05.mp3', 'slide12_jordan_06.mp3'],
            13: ['slide13_jordan_01.mp3', 'slide13_alex_02.mp3', 'slide13_jordan_03.mp3', 'slide13_alex_04.mp3', 'slide13_jordan_05.mp3', 'slide13_alex_06.mp3'],
            14: ['slide14_alex_01.mp3', 'slide14_jordan_02.mp3', 'slide14_alex_03.mp3', 'slide14_jordan_04.mp3', 'slide14_alex_05.mp3', 'slide14_jordan_06.mp3', 'slide14_alex_07.mp3'],
            15: ['slide15_alex_01.mp3', 'slide15_jordan_02.mp3', 'slide15_alex_03.mp3', 'slide15_jordan_04.mp3', 'slide15_alex_05.mp3', 'slide15_jordan_06.mp3', 'slide15_alex_07.mp3'],
            16: ['slide16_jordan_01.mp3', 'slide16_alex_02.mp3', 'slide16_jordan_03.mp3', 'slide16_alex_04.mp3', 'slide16_jordan_05.mp3', 'slide16_alex_06.mp3', 'slide16_jordan_07.mp3'],
            17: ['slide17_jordan_01.mp3', 'slide17_alex_02.mp3', 'slide17_jordan_03.mp3', 'slide17_alex_04.mp3', 'slide17_jordan_05.mp3', 'slide17_alex_06.mp3', 'slide17_jordan_07.mp3'],
            18: ['slide18_alex_01.mp3', 'slide18_jordan_02.mp3', 'slide18_alex_03.mp3', 'slide18_jordan_04.mp3', 'slide18_alex_05.mp3', 'slide18_jordan_06.mp3', 'slide18_alex_07.mp3', 'slide18_jordan_08.mp3']
        };
        // Subtitle text for each audio segment (speaker: ALEX or JORDAN)
        const slideSubtitles = {
            1: [
                {speaker: 'ALEX', text: "Hey everyone, welcome to our deep dive into the Pismo Disputes workflow. I'm Alex, and I'll be your guide through the state machine, API endpoints, and all the technical details that make this system tick."},
                {speaker: 'JORDAN', text: "And I'm Jordan. I'll be covering the UX side of things, showing you how to translate all that technical goodness into interfaces that your users will actually enjoy. Or at least, not actively dislike."},
                {speaker: 'ALEX', text: "That's setting the bar high, Jordan. By the end of this presentation, you'll know exactly how to build dispute workflow dialogs that handle every state, every edge case, and every network quirk."},
                {speaker: 'JORDAN', text: "Think of it as your blueprint for building a disputes system that doesn't make bank operators want to throw their monitors out the window. Let's get into it."}
            ],
            2: [
                {speaker: 'JORDAN', text: "So before we dive into the technical weeds, let's talk about what we're actually dealing with. Disputes happen when a cardholder looks at their statement and says, Wait, I didn't buy that."},
                {speaker: 'ALEX', text: "Or I definitely returned that item, or Why am I still being charged for this subscription I cancelled three months ago? Basically, any time there's a disagreement about a card transaction."},
                {speaker: 'JORDAN', text: "And here's why this matters to the business side. The global chargeback volume exceeds two hundred billion dollars annually. That's not a typo. Two hundred billion with a B."},
                {speaker: 'ALEX', text: "For issuers, handling disputes efficiently isn't just about customer service. It's about recovering funds for cardholders, maintaining network compliance, and avoiding penalty fees."},
                {speaker: 'JORDAN', text: "Plus, a bad disputes experience can tank your customer satisfaction scores faster than you can say chargeback rejected. So yeah, this stuff matters."}
            ],
            3: [
                {speaker: 'ALEX', text: "Let's break down the three main categories of disputes you'll encounter. First up: Merchant Error. This is when the merchant genuinely messed something up."},
                {speaker: 'JORDAN', text: "Wrong amount charged, duplicate transactions, goods that never arrived. These are usually the most straightforward disputes because there's a clear paper trail."},
                {speaker: 'ALEX', text: "Second category is Identity Fraud. This is the scary one where someone's card details get stolen and used without authorization."},
                {speaker: 'JORDAN', text: "These disputes require the most evidence because you're essentially saying a crime occurred. Cardholder statements, police reports, IP logs. The more documentation, the better."},
                {speaker: 'ALEX', text: "And then there's the controversial third type: Friendly Fraud. This is when the cardholder actually did make the purchase but disputes it anyway."},
                {speaker: 'JORDAN', text: "Maybe they forgot about it, maybe buyer's remorse kicked in, or maybe they're just hoping for free stuff. Your UI needs to handle all three types."}
            ],
            4: [
                {speaker: 'ALEX', text: "Alright, time for my favorite part. The PRIMITIVE state machine is Pismo's core architecture for managing dispute lifecycles."},
                {speaker: 'JORDAN', text: "What it lacks in naming transparency, it makes up for in flexibility. This thing is designed to let issuers build their own workflows on top of it."},
                {speaker: 'ALEX', text: "Here's the key concept: disputes move through states via events. You fire an event, the system validates the transition, and the dispute lands in a new state."},
                {speaker: 'JORDAN', text: "The state machine has eight major groups. Think of them like chapters in a book, except this book has multiple endings and some of them are sad."},
                {speaker: 'ALEX', text: "The groups are OPEN, CARDNETWORK_CHARGEBACK, SECOND_PRESENTMENT, PREARBITRATION, DENIED, FAILED, LOSS, and WON. We'll cover each one."}
            ],
            5: [
                {speaker: 'ALEX', text: "Let's walk through each state group. OPEN is where everything begins. It contains the PENDING state, the dispute's waiting room before submission."},
                {speaker: 'JORDAN', text: "CARDNETWORK_CHARGEBACK is the active phase. This includes OPENED, CHARGEBACK_CREATED, and CHARGEBACK_PENDING_DOCUMENTATION."},
                {speaker: 'ALEX', text: "CARDNETWORK_SECOND_PRESENTMENT kicks in when the acquirer decides to fight back. They're saying, Nope, this chargeback isn't valid."},
                {speaker: 'JORDAN', text: "CARDNETWORK_PREARBITRATION is the escalation zone. If second presentment didn't resolve things, this is where the card network makes the final call."},
                {speaker: 'ALEX', text: "Then we have our terminal groups. DENIED means canceled. FAILED means something went wrong. LOSS means the issuer lost. And WON means party time."},
                {speaker: 'JORDAN', text: "Your UI needs to clearly communicate which outcome occurred and what it means financially."}
            ],
            6: [
                {speaker: 'JORDAN', text: "Let's zoom out and look at the big picture. The dispute workflow has four main phases that every dispute passes through."},
                {speaker: 'ALEX', text: "Phase one is Dispute Creation. The cardholder contacts their bank, the operator creates a dispute, evidence gets uploaded, and the OPEN event fires."},
                {speaker: 'JORDAN', text: "Phase two is Network Processing. Pismo takes the ball and runs it over to the card network. They respond with either an acceptance or rejection."},
                {speaker: 'ALEX', text: "Phase three is Resolution, and it can go multiple rounds. The acquirer might accept, contest, or let it expire."},
                {speaker: 'JORDAN', text: "Phase four is Terminal States. Won, lost, canceled, or failed. Your UI needs to guide users through each phase."},
                {speaker: 'ALEX', text: "The whole process can take anywhere from a few days to several months. Build your UI with that timeline in mind."}
            ],
            7: [
                {speaker: 'ALEX', text: "Let's get hands-on. Creating a dispute starts with a POST request to the disputes endpoint. You need account ID, transaction ID, and reason code."},
                {speaker: 'JORDAN', text: "From the UI side, this is our Dispute Creation Dialog. We use a Shadcn Dialog component with form inputs for each required field."},
                {speaker: 'ALEX', text: "Once the API returns successfully, the dispute lands in PENDING status. This is where you can add evidence and prep everything."},
                {speaker: 'JORDAN', text: "Our mockup shows a clean three-section form. Transaction details, dispute type, and evidence checklist."},
                {speaker: 'ALEX', text: "Pro tip: validate everything client-side before hitting the API. Nothing frustrates operators more than form errors at the end."},
                {speaker: 'JORDAN', text: "We also show a What's Next panel that explains the PENDING state. Transparency builds trust."}
            ],
            8: [
                {speaker: 'JORDAN', text: "Evidence is the lifeblood of disputes. Without proper documentation, even legitimate chargebacks get rejected."},
                {speaker: 'ALEX', text: "The API endpoint is POST to disputes slash ID slash files. PDFs up to ten megabytes, images up to five."},
                {speaker: 'JORDAN', text: "Our UI shows a checklist generated from the reason code. Required documents and supporting documents clearly marked."},
                {speaker: 'ALEX', text: "The drag-and-drop zone supports multi-file upload with progress indicators and status badges."},
                {speaker: 'JORDAN', text: "We include inline validation warnings. Catch errors before uploads waste time."},
                {speaker: 'ALEX', text: "Remember: the API validates technical requirements, not evidence quality. Train operators to collect strong evidence."}
            ],
            9: [
                {speaker: 'ALEX', text: "This is the point of no return. Once you fire the OPEN event, the dispute gets submitted to the card network."},
                {speaker: 'JORDAN', text: "Our confirmation dialog includes a final checklist review. All evidence, all forms, and a clear warning this cannot be undone."},
                {speaker: 'ALEX', text: "The API call is PUT to disputes slash ID slash status with event set to OPEN. Success means OPENED status."},
                {speaker: 'JORDAN', text: "The mockup shows the dispute amount prominently, a timeline, and big clear action buttons."},
                {speaker: 'ALEX', text: "After opening, expect five to seven business days for network response. Varies by network and dispute type."},
                {speaker: 'JORDAN', text: "We show a status banner saying Submitted to Network with an estimated timeline. Managing expectations is key."}
            ],
            10: [
                {speaker: 'JORDAN', text: "Good news arrives. The network accepted the dispute and created a chargeback. CHARGEBACK_CREATED status."},
                {speaker: 'ALEX', text: "Funds have been provisionally credited to the cardholder. Provisionally because the merchant can still contest."},
                {speaker: 'JORDAN', text: "Our Chargeback Review screen uses an Alert component. Green success banner and clear status badge."},
                {speaker: 'ALEX', text: "The response includes network reference number and accepted amount. Parse these carefully for next steps."},
                {speaker: 'JORDAN', text: "We show What Can Happen Next with three outcomes: accept loss, contest, or expire."},
                {speaker: 'ALEX', text: "About thirty percent of chargebacks get contested. Prepare operators for that possibility."}
            ],
            11: [
                {speaker: 'ALEX', text: "Plot twist. The acquirer didn't accept. They've submitted a second presentment with counter-evidence."},
                {speaker: 'JORDAN', text: "This is SECOND_PRESENTMENT status with a critical deadline. Thirty to forty-five days to respond. Miss it and you lose."},
                {speaker: 'ALEX', text: "The acquirer's evidence arrives through webhooks. Documents and rebuttal arguments that need to be surfaced in your UI."},
                {speaker: 'JORDAN', text: "Our Alert Dialog has a prominent countdown timer. Days remaining and recommended actions."},
                {speaker: 'ALEX', text: "Three options: Accept loss, escalate to pre-arbitration, or do nothing and expire. Only one is good."},
                {speaker: 'JORDAN', text: "Side-by-side evidence comparison helps operators decide whether escalation is worth it."}
            ],
            12: [
                {speaker: 'ALEX', text: "We've escalated to pre-arbitration. PRE_ARBITRATION_OPENED status. The card network makes the final call."},
                {speaker: 'JORDAN', text: "Important: pre-arbitration has fees. Escalate and lose, you pay arbitration costs. Communicate this risk clearly."},
                {speaker: 'ALEX', text: "The API requires comprehensive evidence and network-specific questions. Visa and Mastercard have different requirements."},
                {speaker: 'JORDAN', text: "Our wizard has three steps. Review evidence, add documentation, confirm with fee disclosure."},
                {speaker: 'ALEX', text: "Thirty to forty-five days for the network decision. ACCEPTED means you won. DECLINED means you lost."},
                {speaker: 'JORDAN', text: "Color-coded badges show which evidence was most relevant to each phase."}
            ],
            13: [
                {speaker: 'JORDAN', text: "Every dispute eventually ends. Let's talk about what winning and losing actually look like."},
                {speaker: 'ALEX', text: "Winning lands you in CHARGEBACK_ACCEPTED or PRE_ARBITRATION_ACCEPTED. Provisional credit becomes permanent."},
                {speaker: 'JORDAN', text: "Our win summary shows a green badge, final amount recovered, and complete timeline."},
                {speaker: 'ALEX', text: "Losing is more varied. EXPIRED, REJECTED, DECLINED, or ISSUER_LOSS. Each needs different messaging."},
                {speaker: 'JORDAN', text: "Missing a deadline deserves root cause analysis. Network rejection might indicate weak evidence."},
                {speaker: 'ALEX', text: "Financial reconciliation happens automatically, but show the impact clearly. What was recovered? What was lost?"}
            ],
            14: [
                {speaker: 'ALEX', text: "Let's talk network specifics, starting with Visa. They have unique requirements around form submission."},
                {speaker: 'JORDAN', text: "Visa uses Collaboration questionnaires and Allocation questionnaires. Submit these before opening the dispute."},
                {speaker: 'ALEX', text: "Collaboration forms gather fraud detection details. Allocation forms handle chip liability disputes."},
                {speaker: 'JORDAN', text: "Our form wizard detects the reason code and shows the appropriate questionnaire with structured inputs."},
                {speaker: 'ALEX', text: "Visa has PRE_ARB_ALLOCATION which bypasses second presentment for certain disputes. Account for this path."},
                {speaker: 'JORDAN', text: "Reason codes use dot notation. Ten dot X for fraud, eleven for authorization, twelve for processing, thirteen for consumer."},
                {speaker: 'ALEX', text: "Watch for VFMP cases. The Visa Fraud Monitoring Program has special requirements and faster processing."}
            ],
            15: [
                {speaker: 'ALEX', text: "Next is Mastercard. The big difference is the EBDF form, Electronic Batch Dispute File."},
                {speaker: 'JORDAN', text: "Every Mastercard dispute requires EBDF submission. Your UI needs to collect all required fields."},
                {speaker: 'ALEX', text: "Mastercard uses TQR4 reports for reconciliation. Integrate this data for comprehensive reporting."},
                {speaker: 'JORDAN', text: "Reason codes use four-digit format starting with forty-eight. Common ones include forty-eight fifty-three."},
                {speaker: 'ALEX', text: "Mastercard's process is more linear than Visa. Second presentment to pre-arbitration to decision."},
                {speaker: 'JORDAN', text: "Our UI emphasizes EBDF fields with inline validation. Show errors immediately."},
                {speaker: 'ALEX', text: "Watch for dispute fees. Mastercard charges for certain outcomes. Track them in reconciliation."}
            ],
            16: [
                {speaker: 'JORDAN', text: "Last is ELO, a Brazilian card network. Important for LATAM markets."},
                {speaker: 'ALEX', text: "The biggest difference: evidence uploads go through ELO's portal manually, not through Pismo's API."},
                {speaker: 'JORDAN', text: "Yes, manual portal uploads. Your UI needs to clearly indicate this is an external step."},
                {speaker: 'ALEX', text: "Pismo still manages the lifecycle. Create, open, and track through Pismo. Evidence lives outside."},
                {speaker: 'JORDAN', text: "We use warning banners and confirmations so operators don't miss the portal upload step."},
                {speaker: 'ALEX', text: "ELO codes use three digits. One hundreds for authorization, two hundreds for processing, three hundreds for consumer, four hundreds for fraud."},
                {speaker: 'JORDAN', text: "For LATAM, consider Portuguese language support. Some documentation may need to be in Portuguese."}
            ],
            17: [
                {speaker: 'JORDAN', text: "Alright developers, let's get practical. You've seen the workflow. Now let's build the components."},
                {speaker: 'ALEX', text: "Your dialogs need to be state-aware. Pull the status and render the appropriate component."},
                {speaker: 'JORDAN', text: "Shadcn building blocks: Dialog, Card, Badge, Button, Form components, and AlertDialog."},
                {speaker: 'ALEX', text: "For timeline visualization, map to state groups. Show current phase and possible next states."},
                {speaker: 'JORDAN', text: "Action buttons should be smart. Grey out invalid actions. Show tooltips. Confirm destructive actions."},
                {speaker: 'ALEX', text: "Form validation is critical. Check evidence requirements before allowing the OPEN event."},
                {speaker: 'JORDAN', text: "Handle loading states and errors gracefully. Network latency is real. Surface meaningful messages."}
            ],
            18: [
                {speaker: 'ALEX', text: "We've covered a lot. Let's wrap up with key takeaways."},
                {speaker: 'JORDAN', text: "First, understand the state machine. Eight groups with specific transitions. Map your UI to these groups."},
                {speaker: 'ALEX', text: "Second, network differences matter. Visa forms, Mastercard EBDF, ELO portal uploads. Handle all three."},
                {speaker: 'JORDAN', text: "Third, evidence is everything. Strong documentation wins. Guide operators to collect the right evidence."},
                {speaker: 'ALEX', text: "Fourth, deadlines are critical. Build countdown timers and notifications to keep operators on track."},
                {speaker: 'JORDAN', text: "Fifth, design for the full lifecycle. Disputes take months. Tell the complete story."},
                {speaker: 'ALEX', text: "Check the Pismo developer docs. Disputes overview and state machine reference are essential reading."},
                {speaker: 'JORDAN', text: "Test with real scenarios in sandbox. Edge cases will find you in production if you don't find them first. Happy coding!"}
            ]
        };


        // Flatten audio files for preloading
        const allAudioFiles = Object.values(slideAudio).flat().map(f => 'assets/audio/' + f);

        // Preload audio files
        const audioCache = {};
        allAudioFiles.forEach(src => {
            const audio = new Audio();
            audio.preload = 'auto';
            audio.src = src;
            audioCache[src] = audio;
        });

        // Slide management
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        let currentSlide = 0;
        let isPlaying = false;
        let currentAudio = null;
        let currentSegmentIndex = 0;
        let autoPlayEnabled = false;

        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const audioBtn = document.getElementById('audioBtn');
        const autoPlayBtn = document.getElementById('autoPlayBtn');
        const slideCounter = document.getElementById('slideCounter');
        const progress = document.getElementById('progress');
        const minimap = document.getElementById('minimap');
        const subtitleContainer = document.getElementById('subtitle-container');
        const subtitleAvatar = document.getElementById('avatar');
        const subtitleText = document.getElementById('subtitle-text');

        function updateMinimap() {
            // Slides 7-13 (0-indexed: 6-12) should show the minimap
            const showMinimapOnSlide = (currentSlide >= 6 && currentSlide <= 12);

            if (showMinimapOnSlide) {
                minimap.classList.add('visible');

                // Map slides to states in the workflow:
                // Slide 7 (idx 6): PENDING - Creating dispute
                // Slide 8 (idx 7): PENDING - Uploading evidence (still pending)
                // Slide 9 (idx 8): OPENED - Opening dispute
                // Slide 10 (idx 9): CHARGEBACK - Chargeback created
                // Slide 11 (idx 10): 2ND_PRES - Second presentment
                // Slide 12 (idx 11): PRE-ARB - Pre-arbitration
                // Slide 13 (idx 12): RESOLVED - Terminal states (WON/LOSS)

                // Define state progression based on slide
                const stateMap = {
                    6: { current: 'pending', completed: [] },
                    7: { current: 'pending', completed: [] },
                    8: { current: 'opened', completed: ['pending'] },
                    9: { current: 'chargeback', completed: ['pending', 'opened'] },
                    10: { current: '2ndpres', completed: ['pending', 'opened', 'chargeback'] },
                    11: { current: 'prearb', completed: ['pending', 'opened', 'chargeback', '2ndpres'] },
                    12: { current: 'won', completed: ['pending', 'opened', 'chargeback', '2ndpres', 'prearb'] }
                };

                const currentStateInfo = stateMap[currentSlide] || stateMap[6];

                // Update all state nodes
                const stateNodes = minimap.querySelectorAll('.minimap-node');
                stateNodes.forEach((node) => {
                    const state = node.dataset.state;
                    node.classList.remove('completed', 'current', 'upcoming');

                    if (currentStateInfo.completed.includes(state)) {
                        node.classList.add('completed');
                    } else if (state === currentStateInfo.current) {
                        node.classList.add('current');
                    } else {
                        node.classList.add('upcoming');
                    }
                });

                // Update arrows based on completed path
                const arrows = minimap.querySelectorAll('.minimap-arrow');
                arrows.forEach((arrow) => {
                    const arrowId = arrow.dataset.arrow;
                    arrow.classList.remove('completed', 'current');

                    // Define which arrows should be highlighted for each state
                    const completedArrows = {
                        'pending': [],
                        'opened': ['pending-opened'],
                        'chargeback': ['pending-opened', 'opened-chargeback'],
                        '2ndpres': ['pending-opened', 'opened-chargeback', 'chargeback-2ndpres'],
                        'prearb': ['pending-opened', 'opened-chargeback', 'chargeback-2ndpres', '2ndpres-prearb'],
                        'won': ['pending-opened', 'opened-chargeback', 'chargeback-2ndpres', '2ndpres-prearb', 'prearb-won']
                    };

                    const currentArrows = {
                        'pending': [],
                        'opened': ['pending-opened'],
                        'chargeback': ['opened-chargeback'],
                        '2ndpres': ['chargeback-2ndpres'],
                        'prearb': ['2ndpres-prearb'],
                        'won': ['prearb-won']
                    };

                    const allCompletedArrows = completedArrows[currentStateInfo.current] || [];
                    const activeArrows = currentArrows[currentStateInfo.current] || [];

                    if (activeArrows.includes(arrowId)) {
                        arrow.classList.add('current');
                        // Update the marker
                        arrow.setAttribute('marker-end', 'url(#arrowhead-current)');
                    } else if (allCompletedArrows.includes(arrowId) && !activeArrows.includes(arrowId)) {
                        arrow.classList.add('completed');
                        arrow.setAttribute('marker-end', 'url(#arrowhead-completed)');
                    } else {
                        arrow.setAttribute('marker-end', 'url(#arrowhead)');
                    }
                });
            } else {
                minimap.classList.remove('visible');
            }
        }

        function updateUI() {
            slideCounter.textContent = `${currentSlide + 1} / ${totalSlides}`;
            progress.style.width = `${((currentSlide + 1) / totalSlides) * 100}%`;
            prevBtn.disabled = currentSlide === 0;
            nextBtn.disabled = currentSlide === totalSlides - 1;
            updateMinimap();
        }

        // Reveal element with GSAP animation (for progressive reveal)
        function revealElement(el) {
            el.classList.add('revealed');
            gsap.fromTo(el,
                { opacity: 0, y: 20 },
                { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' }
            );
        }

        // Add highlight effect to element
        function highlightElement(el) {
            el.classList.add('segment-highlight');
            // Remove highlight class after animation completes
            setTimeout(() => {
                el.classList.remove('segment-highlight');
            }, 2000);
        }

        // Reset reveal state for a slide
        function resetSlideReveal(slide) {
            const revealElements = slide.querySelectorAll('[data-reveal-segment]');
            revealElements.forEach(el => {
                el.classList.remove('revealed');
                gsap.set(el, { opacity: 0, y: 20 });
            });
            const highlightElements = slide.querySelectorAll('[data-highlight-segment]');
            highlightElements.forEach(el => {
                el.classList.remove('segment-highlight');
            });
        }

        function animateSlideIn(slide) {
            const title = slide.querySelector('.slide-title');
            const subtitle = slide.querySelector('.slide-subtitle');
            // Get cards that DON'T have data-reveal-segment (those will be revealed progressively)
            const cards = Array.from(slide.querySelectorAll('.slide-card')).filter(
                card => !card.hasAttribute('data-reveal-segment')
            );

            // Reset any progressive reveal elements
            resetSlideReveal(slide);

            gsap.set([title, subtitle, ...cards].filter(Boolean), { opacity: 0, y: 30 });

            const tl = gsap.timeline();

            if (title && !title.hasAttribute('data-reveal-segment')) {
                tl.to(title, { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' });
            }
            if (subtitle && !subtitle.hasAttribute('data-reveal-segment')) {
                tl.to(subtitle, { opacity: 1, y: 0, duration: 0.4, ease: 'power2.out' }, '-=0.3');
            }
            if (cards.length > 0) {
                tl.to(cards, {
                    opacity: 1,
                    y: 0,
                    duration: 0.4,
                    stagger: 0.1,
                    ease: 'power2.out'
                }, '-=0.2');
            }
        }

        function goToSlide(index) {
            if (index < 0 || index >= totalSlides) return;

            // Stop current audio and reset segment index
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            isPlaying = false;
            currentSegmentIndex = 0;
            updateAudioButtonIcon();
            hideSubtitle();
            clearContextualVisuals();

            // Hide current slide
            slides[currentSlide].classList.remove('active');

            // Show new slide
            currentSlide = index;
            slides[currentSlide].classList.add('active');

            // Animate
            animateSlideIn(slides[currentSlide]);

            // Update UI
            updateUI();
        }

        function nextSlide() {
            goToSlide(currentSlide + 1);
        }

        function prevSlide() {
            goToSlide(currentSlide - 1);
        }

        // SVG icons for audio button states
        const playIcon = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
        const pauseIcon = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
        const autoPlayOnIcon = '<svg class="w-5 h-5 text-blue-600" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>';
        const autoPlayOffIcon = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>';

        function updateAudioButtonIcon() {
            audioBtn.innerHTML = isPlaying ? pauseIcon : playIcon;
        }

        function updateAutoPlayButtonIcon() {
            autoPlayBtn.innerHTML = autoPlayEnabled ? autoPlayOnIcon : autoPlayOffIcon;
            autoPlayBtn.classList.toggle('bg-blue-100', autoPlayEnabled);
        }

        // SVG avatars for speakers
        const alexAvatar = `<svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="24" r="24" fill="url(#alexGrad)"/>
            <defs><linearGradient id="alexGrad" x1="0" y1="0" x2="48" y2="48"><stop stop-color="#3b82f6"/><stop offset="1" stop-color="#1d4ed8"/></linearGradient></defs>
            <circle cx="24" cy="18" r="8" fill="#fff" opacity="0.9"/>
            <path d="M12 38c0-6.627 5.373-12 12-12s12 5.373 12 12" fill="#fff" opacity="0.9"/>
            <circle cx="24" cy="18" r="6" fill="#1e40af"/>
            <ellipse cx="22" cy="17" rx="1.5" ry="2" fill="#fff"/>
            <ellipse cx="26" cy="17" rx="1.5" ry="2" fill="#fff"/>
            <path d="M22 21c0 0 1 1.5 2 1.5s2-1.5 2-1.5" stroke="#1e40af" stroke-width="0.8" fill="none" stroke-linecap="round"/>
        </svg>`;

        const jordanAvatar = `<svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="24" r="24" fill="url(#jordanGrad)"/>
            <defs><linearGradient id="jordanGrad" x1="0" y1="0" x2="48" y2="48"><stop stop-color="#8b5cf6"/><stop offset="1" stop-color="#6d28d9"/></linearGradient></defs>
            <circle cx="24" cy="18" r="8" fill="#fff" opacity="0.9"/>
            <path d="M12 38c0-6.627 5.373-12 12-12s12 5.373 12 12" fill="#fff" opacity="0.9"/>
            <circle cx="24" cy="18" r="6" fill="#5b21b6"/>
            <ellipse cx="22" cy="17" rx="1.5" ry="2" fill="#fff"/>
            <ellipse cx="26" cy="17" rx="1.5" ry="2" fill="#fff"/>
            <path d="M21 21.5c0 0 1.5 2 3 2s3-2 3-2" stroke="#5b21b6" stroke-width="0.8" fill="none" stroke-linecap="round"/>
            <path d="M16 12c2-3 5-4 8-4s6 1 8 4c0 0-2 2-8 2s-8-2-8-2" fill="#5b21b6" opacity="0.6"/>
        </svg>`;

        function showSubtitle(speaker, text) {
            // Set avatar SVG based on speaker
            if (speaker === 'ALEX') {
                subtitleAvatar.innerHTML = alexAvatar;
                subtitleAvatar.style.background = 'transparent';
            } else {
                subtitleAvatar.innerHTML = jordanAvatar;
                subtitleAvatar.style.background = 'transparent';
            }
            
            // Set text
            subtitleText.textContent = text;
            
            // Animate in
            gsap.to(subtitleContainer, {
                opacity: 1,
                duration: 0.3,
                ease: 'power2.out'
            });
        }

        function hideSubtitle() {
            gsap.to(subtitleContainer, {
                opacity: 0,
                duration: 0.3,
                ease: 'power2.in'
            });
        }

        // Concept icons - clean SVG line icons for visual memory aids
        const conceptIcons = {
            'dispute': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="5" width="20" height="14" rx="2" stroke-width="1.5"/>
                <path d="M2 10h20" stroke-width="1.5"/>
                <circle cx="12" cy="15" r="2" stroke-width="1.5"/>
                <path d="M12 13v-1" stroke-width="1.5" stroke-linecap="round"/>
            </svg>`,
            'fraud': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke-width="1.5"/>
                <path d="M12 8v4" stroke-width="1.5" stroke-linecap="round"/>
                <circle cx="12" cy="15" r="0.5" fill="currentColor"/>
            </svg>`,
            'deadline': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke-width="1.5"/>
                <path d="M12 6v6l4 2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            'evidence': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" stroke-width="1.5"/>
                <path d="M14 2v6h6" stroke-width="1.5"/>
                <path d="M16 13H8M16 17H8M10 9H8" stroke-width="1.5" stroke-linecap="round"/>
            </svg>`,
            'win': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 21h8M12 17v4M6 3h12l-1 6h2l-7 8-7-8h2L6 3z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            'loss': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke-width="1.5"/>
                <path d="M15 9l-6 6M9 9l6 6" stroke-width="1.5" stroke-linecap="round"/>
            </svg>`,
            'money': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke-width="1.5"/>
                <path d="M12 6v12M9 9c0-1 1-2 3-2s3 1 3 2-1 2-3 2-3 1-3 2 1 2 3 2 3-1 3-2" stroke-width="1.5" stroke-linecap="round"/>
            </svg>`,
            'network': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="5" r="3" stroke-width="1.5"/>
                <circle cx="5" cy="19" r="3" stroke-width="1.5"/>
                <circle cx="19" cy="19" r="3" stroke-width="1.5"/>
                <path d="M12 8v4M8.5 17l2-4M15.5 17l-2-4" stroke-width="1.5"/>
            </svg>`,
            'visa': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="5" width="20" height="14" rx="2" stroke-width="1.5"/>
                <path d="M7 15l2-6h1.5l-2 6H7zM10.5 15l1.5-6h1.5l-1.5 6h-1.5zM14 12.5c0-1 .5-1.5 1.5-1.5s1.5.5 1.5 1.5-.5 1.5-1.5 1.5-1.5-.5-1.5-1.5z" stroke-width="1.5"/>
            </svg>`,
            'mastercard': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="5" width="20" height="14" rx="2" stroke-width="1.5"/>
                <circle cx="9" cy="12" r="3" stroke-width="1.5"/>
                <circle cx="15" cy="12" r="3" stroke-width="1.5"/>
            </svg>`,
            'upload': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" stroke-width="1.5"/>
                <path d="M17 8l-5-5-5 5M12 3v12" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            'state': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="3" width="6" height="6" rx="1" stroke-width="1.5"/>
                <rect x="15" y="3" width="6" height="6" rx="1" stroke-width="1.5"/>
                <rect x="9" y="15" width="6" height="6" rx="1" stroke-width="1.5"/>
                <path d="M6 9v3a3 3 0 003 3h6a3 3 0 003-3V9M12 15v-3" stroke-width="1.5"/>
            </svg>`,
            'chargeback': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 10h18M3 14h18" stroke-width="1.5"/>
                <path d="M12 3L5 10l7 7 7-7-7-7z" stroke-width="1.5"/>
                <path d="M17 17l4 4M21 17l-4 4" stroke-width="1.5" stroke-linecap="round"/>
            </svg>`,
            'arbitration': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 3v18M3 12h18" stroke-width="1.5"/>
                <circle cx="6" cy="6" r="2" stroke-width="1.5"/>
                <circle cx="18" cy="6" r="2" stroke-width="1.5"/>
                <circle cx="6" cy="18" r="2" stroke-width="1.5"/>
                <circle cx="18" cy="18" r="2" stroke-width="1.5"/>
                <circle cx="12" cy="12" r="3" stroke-width="1.5"/>
            </svg>`,
            'workflow': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="4" rx="1" stroke-width="1.5"/>
                <rect x="3" y="10" width="18" height="4" rx="1" stroke-width="1.5"/>
                <rect x="3" y="16" width="18" height="4" rx="1" stroke-width="1.5"/>
                <path d="M7 8v2M17 8v2M7 14v2M17 14v2" stroke-width="1.5"/>
            </svg>`,
            'merchant': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke-width="1.5"/>
                <path d="M9 22V12h6v10" stroke-width="1.5"/>
            </svg>`,
            'user': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="7" r="4" stroke-width="1.5"/>
                <path d="M5.5 21a6.5 6.5 0 0113 0" stroke-width="1.5"/>
            </svg>`,
            'elo': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="5" width="20" height="14" rx="2" stroke-width="1.5"/>
                <path d="M7 12h2M11 10v4M15 12a2 2 0 104 0 2 2 0 00-4 0z" stroke-width="1.5" stroke-linecap="round"/>
            </svg>`,
            'code': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 18l6-6-6-6M8 6l-6 6 6 6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`,
            'summary': `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 11l3 3L22 4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" stroke-width="1.5"/>
            </svg>`
        };

        // Map segments to icons - show icon BEFORE the content reveals
        // Format: 'slideNum-segmentNum': iconKey or [iconKeys]
        const segmentIcons = {
            // Slide 1: Title/Intro
            '1-1': 'state',

            // Slide 2: What Are Disputes
            '2-1': 'dispute',      // Jordan introduces disputes
            '2-3': 'money',        // $200B statistic
            '2-4': ['fraud', 'merchant', 'money'],  // Three types revealed

            // Slide 3: Types of Disputes
            '3-1': 'merchant',     // Merchant Error
            '3-3': 'fraud',        // Identity Fraud
            '3-5': 'money',        // Friendly Fraud

            // Slide 4: PRIMITIVE State Machine
            '4-1': 'state',        // State machine intro
            '4-3': 'workflow',     // Events and transitions

            // Slide 5: State Groups Deep Dive
            '5-1': 'state',        // OPEN state
            '5-2': 'chargeback',   // CHARGEBACK state
            '5-5': ['win', 'loss'],// Terminal states

            // Slide 6: Core Workflow Overview
            '6-1': 'workflow',     // Big picture
            '6-3': 'network',      // Network processing
            '6-5': 'deadline',     // Deadlines

            // Slide 7: Creating a Dispute
            '7-1': 'code',         // API endpoint
            '7-2': 'dispute',      // Creation dialog
            '7-3': 'state',        // PENDING status

            // Slide 8: Uploading Evidence
            '8-1': 'upload',       // Evidence upload
            '8-3': 'evidence',     // Checklist

            // Slide 9: Opening the Dispute
            '9-1': 'state',        // Point of no return
            '9-3': 'network',      // Submit to network
            '9-5': 'deadline',     // Timeline

            // Slide 10: Chargeback Created
            '10-1': 'win',         // Good news
            '10-3': 'chargeback',  // Chargeback review
            '10-5': 'workflow',    // What happens next

            // Slide 11: Second Presentment
            '11-1': 'chargeback',  // Merchant contests
            '11-3': 'deadline',    // Critical deadline
            '11-5': 'evidence',    // Evidence comparison

            // Slide 12: Pre-Arbitration
            '12-1': 'arbitration', // Escalation
            '12-3': 'money',       // Fees warning
            '12-5': 'deadline',    // Network decision time

            // Slide 13: Terminal States
            '13-1': ['win', 'loss'],// Outcomes
            '13-3': 'win',         // Win summary
            '13-5': 'loss',        // Loss variations

            // Slide 14: Visa Specifics
            '14-1': 'visa',        // Visa intro
            '14-3': 'evidence',    // Forms
            '14-5': 'code',        // Reason codes

            // Slide 15: Mastercard Specifics
            '15-1': 'mastercard',  // Mastercard intro
            '15-3': 'evidence',    // EBDF form
            '15-5': 'code',        // Reason codes

            // Slide 16: ELO Specifics
            '16-1': 'elo',         // ELO intro
            '16-3': 'upload',      // Manual upload
            '16-5': 'code',        // ELO codes

            // Slide 17: Implementation
            '17-1': 'code',        // Practical building
            '17-3': 'state',       // State-aware dialogs
            '17-5': 'workflow',    // Form validation

            // Slide 18: Summary
            '18-1': 'summary',     // Wrap up
            '18-3': 'network',     // Network differences
            '18-5': 'evidence',    // Evidence importance
            '18-7': 'deadline'     // Deadlines critical
        };

        // SVG definitions for contextual floating visuals
        const speechVisuals = {
            // Package Return Scene - Store building with package and return arrow
            'return': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Store/building backdrop -->
                <rect x="120" y="30" width="70" height="80" fill="#e5e7eb" rx="4"/>
                <rect x="135" y="50" width="20" height="25" fill="#d1d5db"/>
                <rect x="155" y="85" width="15" height="25" fill="#9ca3af"/>
                <text x="140" y="25" font-size="10" fill="#6b7280" font-weight="bold">STORE</text>

                <!-- Package with return label -->
                <rect x="20" y="60" width="60" height="50" fill="#fbbf24" rx="4"/>
                <rect x="25" y="65" width="50" height="40" fill="#f59e0b" rx="2"/>
                <rect x="30" y="72" width="40" height="15" fill="#fff" rx="2"/>
                <text x="35" y="83" font-size="8" fill="#dc2626" font-weight="bold">RETURN</text>
                <line x1="30" y1="92" x2="70" y2="92" stroke="#d97706" stroke-width="2"/>
                <line x1="30" y1="98" x2="55" y2="98" stroke="#d97706" stroke-width="2"/>

                <!-- Curved return arrow -->
                <defs>
                    <marker id="returnArrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                    </marker>
                </defs>
                <path d="M85 85 Q100 40 140 70" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#returnArrowhead)"/>
            </svg>`,

            // Recurring Charges Scene - Calendar with $ signs and cancel mark
            'subscription': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Calendar -->
                <rect x="30" y="25" width="85" height="100" fill="#fff" stroke="#d1d5db" stroke-width="2" rx="4"/>
                <rect x="30" y="25" width="85" height="22" fill="#ef4444" rx="4 4 0 0"/>
                <text x="55" y="41" font-size="11" fill="#fff" font-weight="bold">MONTHLY</text>

                <!-- Calendar grid with $ signs -->
                <text x="42" y="65" font-size="14" fill="#6b7280">$</text>
                <text x="65" y="65" font-size="14" fill="#6b7280">$</text>
                <text x="88" y="65" font-size="14" fill="#6b7280">$</text>
                <text x="42" y="85" font-size="14" fill="#6b7280">$</text>
                <text x="65" y="85" font-size="14" fill="#6b7280">$</text>
                <text x="88" y="85" font-size="14" fill="#ef4444" font-weight="bold">$</text>
                <text x="42" y="105" font-size="14" fill="#9ca3af">$</text>
                <text x="65" y="105" font-size="14" fill="#9ca3af">$</text>
                <text x="88" y="105" font-size="14" fill="#9ca3af">$</text>

                <!-- Circular arrows (recurring) -->
                <circle cx="155" cy="70" r="32" stroke="#f59e0b" stroke-width="3" fill="none" stroke-dasharray="150 55"/>
                <polygon points="182,48 192,60 180,68" fill="#f59e0b"/>

                <!-- X cancel mark -->
                <circle cx="155" cy="70" r="18" fill="#fee2e2"/>
                <path d="M146 61 L164 79 M164 61 L146 79" stroke="#dc2626" stroke-width="3" stroke-linecap="round"/>
            </svg>`,

            // Confused Transaction Scene - Receipt with question marks
            'question': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Receipt -->
                <rect x="60" y="15" width="80" height="115" fill="#fff" stroke="#d1d5db" stroke-width="2"/>
                <path d="M60 130 L70 120 L80 130 L90 120 L100 130 L110 120 L120 130 L130 120 L140 130" stroke="#d1d5db" fill="#fff"/>

                <!-- Receipt header -->
                <rect x="70" y="25" width="60" height="12" fill="#e5e7eb" rx="2"/>

                <!-- Receipt lines -->
                <line x1="70" y1="50" x2="130" y2="50" stroke="#e5e7eb" stroke-width="2"/>
                <line x1="70" y1="62" x2="120" y2="62" stroke="#e5e7eb" stroke-width="2"/>
                <line x1="70" y1="74" x2="110" y2="74" stroke="#e5e7eb" stroke-width="2"/>
                <line x1="70" y1="86" x2="115" y2="86" stroke="#e5e7eb" stroke-width="2"/>

                <!-- Unknown amount -->
                <text x="70" y="108" font-size="16" font-weight="bold" fill="#374151">$???</text>

                <!-- Question marks floating -->
                <text x="25" y="45" font-size="28" fill="#f59e0b" font-weight="bold">?</text>
                <text x="155" y="35" font-size="22" fill="#f59e0b" font-weight="bold">?</text>
                <text x="165" y="90" font-size="32" fill="#f59e0b" font-weight="bold">?</text>
                <text x="20" y="100" font-size="20" fill="#fbbf24">?</text>
            </svg>`,

            // $200 Billion Scene - Stack of money with globe
            'money': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Stack of money/bills -->
                <rect x="20" y="85" width="75" height="42" fill="#22c55e" rx="3"/>
                <rect x="25" y="78" width="75" height="42" fill="#16a34a" rx="3"/>
                <rect x="30" y="71" width="75" height="42" fill="#15803d" rx="3"/>
                <rect x="35" y="64" width="75" height="42" fill="#166534" rx="3"/>

                <!-- Dollar signs on bills -->
                <text x="58" y="92" font-size="18" fill="#dcfce7" font-weight="bold">$$$</text>

                <!-- Large number -->
                <text x="125" y="45" font-size="16" fill="#374151" font-weight="bold">$200</text>
                <text x="120" y="68" font-size="22" font-weight="bold" fill="#dc2626">BILLION</text>

                <!-- Globe/world indicator -->
                <circle cx="155" cy="105" r="28" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                <ellipse cx="155" cy="105" rx="28" ry="12" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
                <ellipse cx="155" cy="105" rx="12" ry="28" stroke="#3b82f6" stroke-width="1.5" fill="none"/>
                <line x1="155" y1="77" x2="155" y2="133" stroke="#3b82f6" stroke-width="1"/>
                <line x1="127" y1="105" x2="183" y2="105" stroke="#3b82f6" stroke-width="1"/>
            </svg>`,

            // Identity Theft Scene - Credit card with shadowy figure
            'fraud': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Credit card -->
                <rect x="30" y="55" width="95" height="58" fill="#1e40af" rx="6"/>
                <rect x="30" y="75" width="95" height="14" fill="#fbbf24"/>
                <circle cx="48" cy="100" r="9" fill="#f59e0b"/>
                <circle cx="60" cy="100" r="9" fill="#ef4444" opacity="0.8"/>
                <rect x="85" y="95" width="30" height="8" fill="#60a5fa" rx="2"/>

                <!-- EMV chip -->
                <rect x="42" y="62" width="18" height="12" fill="#fbbf24" rx="2"/>
                <line x1="45" y1="65" x2="57" y2="65" stroke="#d97706" stroke-width="1"/>
                <line x1="45" y1="68" x2="57" y2="68" stroke="#d97706" stroke-width="1"/>
                <line x1="45" y1="71" x2="57" y2="71" stroke="#d97706" stroke-width="1"/>

                <!-- Shadowy figure/mask -->
                <ellipse cx="160" cy="55" rx="28" ry="32" fill="#374151"/>
                <ellipse cx="152" cy="48" rx="6" ry="4" fill="#fff"/>
                <ellipse cx="168" cy="48" rx="6" ry="4" fill="#fff"/>
                <ellipse cx="152" cy="48" rx="3" ry="2" fill="#111"/>
                <ellipse cx="168" cy="48" rx="3" ry="2" fill="#111"/>

                <!-- Steal arrows -->
                <defs>
                    <marker id="fraudArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                        <polygon points="0 0, 8 3, 0 6" fill="#dc2626"/>
                    </marker>
                </defs>
                <path d="M135 85 Q145 95 125 100" stroke="#dc2626" stroke-width="2" stroke-dasharray="5" marker-end="url(#fraudArrow)"/>

                <!-- Warning sign -->
                <polygon points="160,105 178,135 142,135" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                <text x="155" y="130" font-size="18" font-weight="bold" fill="#f59e0b">!</text>
            </svg>`,

            // Missing Delivery Scene - House with ghost package
            'package': `<svg viewBox="0 0 200 150" fill="none">
                <!-- House/door -->
                <rect x="100" y="45" width="85" height="85" fill="#f3f4f6" stroke="#d1d5db" stroke-width="2"/>
                <polygon points="100,45 142,18 185,45" fill="#78716c" stroke="#57534e" stroke-width="1"/>

                <!-- Window -->
                <rect x="110" y="60" width="25" height="25" fill="#bfdbfe" stroke="#93c5fd" stroke-width="1"/>
                <line x1="122" y1="60" x2="122" y2="85" stroke="#93c5fd" stroke-width="1"/>
                <line x1="110" y1="72" x2="135" y2="72" stroke="#93c5fd" stroke-width="1"/>

                <!-- Door -->
                <rect x="150" y="80" width="28" height="50" fill="#92400e"/>
                <circle cx="172" cy="108" r="3" fill="#fbbf24"/>

                <!-- Doorstep -->
                <rect x="105" y="125" width="75" height="10" fill="#d1d5db"/>

                <!-- Ghost package (dashed, not there) -->
                <rect x="20" y="75" width="55" height="45" fill="none" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6"/>
                <line x1="20" y1="75" x2="47" y2="60" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6"/>
                <line x1="75" y1="75" x2="75" y2="60" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6"/>
                <line x1="47" y1="60" x2="75" y2="60" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6"/>
                <text x="32" y="102" font-size="12" fill="#9ca3af">???</text>

                <!-- Question where package should be -->
                <text x="120" y="118" font-size="24" fill="#f59e0b" font-weight="bold">?</text>
            </svg>`,

            // Credit Card Scene - Detailed card with transaction
            'card': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Credit card main -->
                <rect x="30" y="35" width="140" height="85" fill="url(#cardGradient)" rx="8"/>
                <defs>
                    <linearGradient id="cardGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#3b82f6"/>
                        <stop offset="100%" style="stop-color:#1d4ed8"/>
                    </linearGradient>
                </defs>

                <!-- EMV chip -->
                <rect x="50" y="55" width="28" height="22" fill="#fbbf24" rx="3"/>
                <line x1="54" y1="60" x2="74" y2="60" stroke="#d97706" stroke-width="1.5"/>
                <line x1="54" y1="65" x2="74" y2="65" stroke="#d97706" stroke-width="1.5"/>
                <line x1="54" y1="70" x2="74" y2="70" stroke="#d97706" stroke-width="1.5"/>
                <line x1="64" y1="55" x2="64" y2="77" stroke="#d97706" stroke-width="1.5"/>

                <!-- Card number dots -->
                <circle cx="50" cy="95" r="3" fill="#fff" opacity="0.8"/>
                <circle cx="60" cy="95" r="3" fill="#fff" opacity="0.8"/>
                <circle cx="70" cy="95" r="3" fill="#fff" opacity="0.8"/>
                <circle cx="80" cy="95" r="3" fill="#fff" opacity="0.8"/>
                <text x="95" y="99" font-size="12" fill="#fff" opacity="0.8">1234</text>

                <!-- Contactless symbol -->
                <path d="M145 55 Q155 50 155 60" stroke="#fff" stroke-width="2" fill="none" opacity="0.7"/>
                <path d="M145 55 Q160 47 160 65" stroke="#fff" stroke-width="2" fill="none" opacity="0.7"/>
                <path d="M145 55 Q165 44 165 70" stroke="#fff" stroke-width="2" fill="none" opacity="0.7"/>

                <!-- Card brand circles -->
                <circle cx="140" cy="100" r="12" fill="#ef4444" opacity="0.9"/>
                <circle cx="155" cy="100" r="12" fill="#f59e0b" opacity="0.9"/>
            </svg>`,

            // Store Error Scene - Store front with error on register
            'store': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Store front -->
                <rect x="35" y="45" width="130" height="90" fill="#f3f4f6" stroke="#d1d5db" stroke-width="2"/>

                <!-- Awning -->
                <rect x="35" y="35" width="130" height="15" fill="#3b82f6"/>
                <path d="M35 50 Q50 60 65 50 Q80 60 95 50 Q110 60 125 50 Q140 60 155 50 Q170 60 165 50" stroke="#2563eb" stroke-width="2" fill="#3b82f6"/>
                <text x="75" y="47" font-size="10" fill="#fff" font-weight="bold">STORE</text>

                <!-- Window -->
                <rect x="45" y="60" width="35" height="30" fill="#bfdbfe" stroke="#93c5fd"/>

                <!-- Door -->
                <rect x="115" y="85" width="35" height="50" fill="#d1d5db"/>
                <circle cx="145" cy="112" r="3" fill="#6b7280"/>

                <!-- Cash register with error -->
                <rect x="55" y="95" width="40" height="30" fill="#374151" rx="3"/>
                <rect x="60" y="100" width="30" height="15" fill="#dc2626"/>
                <text x="66" y="112" font-size="9" fill="#fff" font-weight="bold">ERR</text>

                <!-- Receipt with wrong amount -->
                <rect x="100" y="60" width="28" height="45" fill="#fff" stroke="#d1d5db"/>
                <text x="105" y="78" font-size="10" fill="#dc2626" font-weight="bold">$99</text>
                <line x1="102" y1="85" x2="125" y2="85" stroke="#e5e7eb" stroke-width="1"/>
                <text x="105" y="98" font-size="8" fill="#6b7280">not $49</text>
            </svg>`,

            // Document/Evidence Scene - Stack of documents with magnifying glass
            'document': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Document stack -->
                <rect x="35" y="40" width="90" height="100" fill="#e5e7eb" rx="2"/>
                <rect x="40" y="35" width="90" height="100" fill="#f3f4f6" rx="2"/>
                <rect x="45" y="30" width="90" height="100" fill="#fff" stroke="#d1d5db" stroke-width="2" rx="2"/>

                <!-- Document content lines -->
                <rect x="55" y="42" width="50" height="8" fill="#3b82f6" rx="1"/>
                <line x1="55" y1="60" x2="125" y2="60" stroke="#e5e7eb" stroke-width="2"/>
                <line x1="55" y1="72" x2="120" y2="72" stroke="#e5e7eb" stroke-width="2"/>
                <line x1="55" y1="84" x2="115" y2="84" stroke="#e5e7eb" stroke-width="2"/>
                <line x1="55" y1="96" x2="110" y2="96" stroke="#e5e7eb" stroke-width="2"/>
                <line x1="55" y1="108" x2="100" y2="108" stroke="#e5e7eb" stroke-width="2"/>

                <!-- Magnifying glass -->
                <circle cx="155" cy="85" r="25" fill="none" stroke="#6b7280" stroke-width="4"/>
                <circle cx="155" cy="85" r="20" fill="#dbeafe" opacity="0.5"/>
                <line x1="172" y1="102" x2="185" y2="120" stroke="#6b7280" stroke-width="6" stroke-linecap="round"/>

                <!-- Checkmark in magnifier -->
                <path d="M145 85 L152 92 L168 76" stroke="#16a34a" stroke-width="3" fill="none" stroke-linecap="round"/>
            </svg>`,

            // State Machine Scene - Connected workflow nodes
            'stateMachine': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Start node -->
                <circle cx="30" cy="75" r="18" fill="#22c55e" stroke="#16a34a" stroke-width="2"/>
                <text x="22" y="80" font-size="10" fill="#fff" font-weight="bold">START</text>

                <!-- Process node 1 -->
                <rect x="65" y="25" width="55" height="35" fill="#3b82f6" rx="4"/>
                <text x="72" y="47" font-size="9" fill="#fff">PENDING</text>

                <!-- Process node 2 -->
                <rect x="65" y="90" width="55" height="35" fill="#f59e0b" rx="4"/>
                <text x="70" y="112" font-size="9" fill="#fff">REVIEW</text>

                <!-- Decision diamond -->
                <polygon points="155,75 175,55 195,75 175,95" fill="#8b5cf6" stroke="#7c3aed" stroke-width="2"/>
                <text x="167" y="79" font-size="8" fill="#fff">?</text>

                <!-- End nodes -->
                <circle cx="175" cy="25" r="15" fill="#dc2626"/>
                <text x="165" y="29" font-size="8" fill="#fff">DENY</text>

                <circle cx="175" cy="125" r="15" fill="#16a34a"/>
                <text x="163" y="129" font-size="7" fill="#fff">APPROVE</text>

                <!-- Arrows -->
                <defs>
                    <marker id="stateArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                        <polygon points="0 0, 8 3, 0 6" fill="#6b7280"/>
                    </marker>
                </defs>
                <path d="M48 65 L65 45" stroke="#6b7280" stroke-width="2" marker-end="url(#stateArrow)"/>
                <path d="M48 85 L65 105" stroke="#6b7280" stroke-width="2" marker-end="url(#stateArrow)"/>
                <path d="M120 42 L155 60" stroke="#6b7280" stroke-width="2" marker-end="url(#stateArrow)"/>
                <path d="M120 107 L155 90" stroke="#6b7280" stroke-width="2" marker-end="url(#stateArrow)"/>
                <path d="M175 55 L175 42" stroke="#6b7280" stroke-width="2" marker-end="url(#stateArrow)"/>
                <path d="M175 95 L175 108" stroke="#6b7280" stroke-width="2" marker-end="url(#stateArrow)"/>
            </svg>`,

            // Clock/Deadline Scene - Clock with urgency indicators
            'clock': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Clock face -->
                <circle cx="100" cy="75" r="55" fill="#fff" stroke="#374151" stroke-width="4"/>
                <circle cx="100" cy="75" r="50" fill="#f9fafb"/>

                <!-- Hour markers -->
                <line x1="100" y1="28" x2="100" y2="35" stroke="#374151" stroke-width="3"/>
                <line x1="100" y1="115" x2="100" y2="122" stroke="#374151" stroke-width="3"/>
                <line x1="53" y1="75" x2="60" y2="75" stroke="#374151" stroke-width="3"/>
                <line x1="140" y1="75" x2="147" y2="75" stroke="#374151" stroke-width="3"/>

                <!-- Clock hands -->
                <line x1="100" y1="75" x2="100" y2="42" stroke="#374151" stroke-width="4" stroke-linecap="round"/>
                <line x1="100" y1="75" x2="128" y2="88" stroke="#dc2626" stroke-width="3" stroke-linecap="round"/>

                <!-- Center dot -->
                <circle cx="100" cy="75" r="5" fill="#374151"/>

                <!-- Urgency indicators -->
                <path d="M160 30 L170 20 L180 30" stroke="#f59e0b" stroke-width="3" fill="none"/>
                <path d="M160 40 L170 30 L180 40" stroke="#f59e0b" stroke-width="3" fill="none"/>
                <path d="M160 50 L170 40 L180 50" stroke="#f59e0b" stroke-width="3" fill="none"/>

                <!-- Days counter -->
                <rect x="15" y="100" width="45" height="30" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="4"/>
                <text x="22" y="120" font-size="11" fill="#92400e" font-weight="bold">45 DAYS</text>
            </svg>`,

            // Card Network Scene - Interconnected network of banks and cards
            'network': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Central hub -->
                <circle cx="100" cy="75" r="25" fill="#3b82f6"/>
                <text x="82" y="80" font-size="10" fill="#fff" font-weight="bold">NETWORK</text>

                <!-- Issuer node -->
                <circle cx="35" cy="40" r="20" fill="#22c55e"/>
                <text x="22" y="44" font-size="8" fill="#fff">ISSUER</text>

                <!-- Acquirer node -->
                <circle cx="165" cy="40" r="20" fill="#f59e0b"/>
                <text x="148" y="44" font-size="7" fill="#fff">ACQUIRER</text>

                <!-- Cardholder node -->
                <circle cx="35" cy="115" r="20" fill="#8b5cf6"/>
                <text x="18" y="119" font-size="7" fill="#fff">HOLDER</text>

                <!-- Merchant node -->
                <circle cx="165" cy="115" r="20" fill="#ec4899"/>
                <text x="145" y="119" font-size="7" fill="#fff">MERCHANT</text>

                <!-- Connection lines -->
                <line x1="52" y1="50" x2="78" y2="62" stroke="#6b7280" stroke-width="2"/>
                <line x1="148" y1="50" x2="122" y2="62" stroke="#6b7280" stroke-width="2"/>
                <line x1="52" y1="105" x2="78" y2="88" stroke="#6b7280" stroke-width="2"/>
                <line x1="148" y1="105" x2="122" y2="88" stroke="#6b7280" stroke-width="2"/>

                <!-- Data flow arrows -->
                <circle cx="65" cy="55" r="4" fill="#3b82f6"/>
                <circle cx="135" cy="55" r="4" fill="#3b82f6"/>
                <circle cx="65" cy="98" r="4" fill="#3b82f6"/>
                <circle cx="135" cy="98" r="4" fill="#3b82f6"/>
            </svg>`,

            // Shield/Protection Scene - Shield with checkmark
            'shield': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Shield shape -->
                <path d="M100 15 L165 35 L165 75 C165 110 100 140 100 140 C100 140 35 110 35 75 L35 35 Z"
                      fill="url(#shieldGradient)" stroke="#1d4ed8" stroke-width="3"/>
                <defs>
                    <linearGradient id="shieldGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#3b82f6"/>
                        <stop offset="100%" style="stop-color:#1e40af"/>
                    </linearGradient>
                </defs>

                <!-- Inner shield highlight -->
                <path d="M100 30 L150 45 L150 75 C150 100 100 125 100 125 C100 125 50 100 50 75 L50 45 Z"
                      fill="none" stroke="#60a5fa" stroke-width="2" opacity="0.5"/>

                <!-- Checkmark -->
                <path d="M70 75 L90 95 L130 55" stroke="#fff" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

                <!-- Protection rays -->
                <line x1="15" y1="30" x2="28" y2="40" stroke="#fbbf24" stroke-width="2"/>
                <line x1="10" y1="50" x2="25" y2="55" stroke="#fbbf24" stroke-width="2"/>
                <line x1="185" y1="30" x2="172" y2="40" stroke="#fbbf24" stroke-width="2"/>
                <line x1="190" y1="50" x2="175" y2="55" stroke="#fbbf24" stroke-width="2"/>
            </svg>`,

            // Approval/Check Scene - Success checkmark with celebration
            'check': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Success circle -->
                <circle cx="100" cy="75" r="50" fill="#dcfce7" stroke="#16a34a" stroke-width="4"/>

                <!-- Checkmark -->
                <path d="M70 75 L90 95 L130 55" stroke="#16a34a" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

                <!-- Celebration particles -->
                <circle cx="45" cy="35" r="5" fill="#fbbf24"/>
                <circle cx="155" cy="40" r="4" fill="#3b82f6"/>
                <circle cx="160" cy="115" r="5" fill="#ec4899"/>
                <circle cx="40" cy="110" r="4" fill="#8b5cf6"/>

                <!-- Sparkle stars -->
                <path d="M30 65 L35 60 L40 65 L35 70 Z" fill="#fbbf24"/>
                <path d="M170 75 L175 70 L180 75 L175 80 Z" fill="#fbbf24"/>
                <path d="M100 15 L103 22 L110 25 L103 28 L100 35 L97 28 L90 25 L97 22 Z" fill="#fbbf24"/>

                <!-- Approved text -->
                <rect x="60" y="130" width="80" height="18" fill="#16a34a" rx="4"/>
                <text x="72" y="143" font-size="10" fill="#fff" font-weight="bold">APPROVED</text>
            </svg>`,

            // Denial/X Scene - Rejection with warning
            'x': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Denial circle -->
                <circle cx="100" cy="75" r="50" fill="#fee2e2" stroke="#dc2626" stroke-width="4"/>

                <!-- X mark -->
                <path d="M70 45 L130 105 M130 45 L70 105" stroke="#dc2626" stroke-width="8" stroke-linecap="round"/>

                <!-- Warning triangles -->
                <polygon points="30,60 45,35 60,60" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                <text x="42" y="55" font-size="12" fill="#f59e0b" font-weight="bold">!</text>

                <polygon points="140,120 155,95 170,120" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                <text x="152" y="115" font-size="12" fill="#f59e0b" font-weight="bold">!</text>

                <!-- Denied text -->
                <rect x="65" y="130" width="70" height="18" fill="#dc2626" rx="4"/>
                <text x="82" y="143" font-size="10" fill="#fff" font-weight="bold">DENIED</text>
            </svg>`,

            // Bank/Institution Scene - Bank building with columns
            'bank': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Bank building base -->
                <rect x="30" y="55" width="140" height="80" fill="#f3f4f6" stroke="#d1d5db" stroke-width="2"/>

                <!-- Roof/pediment -->
                <polygon points="20,55 100,20 180,55" fill="#374151"/>
                <polygon points="30,55 100,28 170,55" fill="#4b5563"/>

                <!-- Columns -->
                <rect x="45" y="60" width="15" height="70" fill="#e5e7eb"/>
                <rect x="75" y="60" width="15" height="70" fill="#e5e7eb"/>
                <rect x="110" y="60" width="15" height="70" fill="#e5e7eb"/>
                <rect x="140" y="60" width="15" height="70" fill="#e5e7eb"/>

                <!-- Column capitals -->
                <rect x="42" y="55" width="21" height="8" fill="#d1d5db"/>
                <rect x="72" y="55" width="21" height="8" fill="#d1d5db"/>
                <rect x="107" y="55" width="21" height="8" fill="#d1d5db"/>
                <rect x="137" y="55" width="21" height="8" fill="#d1d5db"/>

                <!-- Door -->
                <rect x="85" y="95" width="30" height="40" fill="#1e40af"/>
                <circle cx="100" cy="115" r="3" fill="#fbbf24"/>

                <!-- Bank text -->
                <text x="75" y="45" font-size="14" fill="#fff" font-weight="bold">BANK</text>

                <!-- Dollar sign decoration -->
                <circle cx="100" cy="75" r="12" fill="#fbbf24"/>
                <text x="94" y="80" font-size="14" fill="#92400e" font-weight="bold">$</text>
            </svg>`,

            // User/Cardholder Scene - Professional abstract user with devices
            'user': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Abstract user icon (professional) -->
                <circle cx="100" cy="45" r="22" fill="none" stroke="#3b82f6" stroke-width="3"/>
                <path d="M65 115 C65 85 85 70 100 70 C115 70 135 85 135 115" fill="none" stroke="#3b82f6" stroke-width="3"/>

                <!-- Phone -->
                <rect x="25" y="50" width="35" height="60" fill="#f3f4f6" stroke="#6b7280" stroke-width="2" rx="4"/>
                <rect x="29" y="56" width="27" height="42" fill="#dbeafe"/>
                <circle cx="42" cy="104" r="3" fill="#9ca3af"/>

                <!-- Credit card -->
                <rect x="145" y="55" width="48" height="30" fill="#1e40af" rx="3"/>
                <rect x="145" y="70" width="48" height="8" fill="#fbbf24"/>
                <rect x="150" y="60" width="12" height="8" fill="#fbbf24" rx="1"/>

                <!-- Connection lines -->
                <path d="M60 80 L75 70" stroke="#d1d5db" stroke-width="2" stroke-dasharray="4"/>
                <path d="M140 80 L125 70" stroke="#d1d5db" stroke-width="2" stroke-dasharray="4"/>

                <!-- UX text label -->
                <text x="75" y="138" font-size="12" fill="#6b7280" font-weight="500">USER EXPERIENCE</text>
            </svg>`,

            // Workflow/Process Scene - Connected process steps
            'workflow': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Step 1 -->
                <rect x="15" y="55" width="45" height="40" fill="#3b82f6" rx="4"/>
                <text x="22" y="72" font-size="8" fill="#fff">INTAKE</text>
                <text x="25" y="85" font-size="16" fill="#fff">1</text>

                <!-- Arrow 1 -->
                <path d="M60 75 L75 75" stroke="#6b7280" stroke-width="3" marker-end="url(#workflowArrow)"/>

                <!-- Step 2 -->
                <rect x="78" y="55" width="45" height="40" fill="#f59e0b" rx="4"/>
                <text x="82" y="72" font-size="8" fill="#fff">REVIEW</text>
                <text x="95" y="85" font-size="16" fill="#fff">2</text>

                <!-- Arrow 2 -->
                <path d="M123 75 L138 75" stroke="#6b7280" stroke-width="3" marker-end="url(#workflowArrow)"/>

                <!-- Step 3 -->
                <rect x="141" y="55" width="45" height="40" fill="#22c55e" rx="4"/>
                <text x="145" y="72" font-size="8" fill="#fff">RESOLVE</text>
                <text x="158" y="85" font-size="16" fill="#fff">3</text>

                <defs>
                    <marker id="workflowArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280"/>
                    </marker>
                </defs>

                <!-- Progress bar -->
                <rect x="15" y="110" width="171" height="12" fill="#e5e7eb" rx="6"/>
                <rect x="15" y="110" width="100" height="12" fill="#22c55e" rx="6"/>
                <text x="72" y="119" font-size="8" fill="#fff" font-weight="bold">60%</text>

                <!-- Labels -->
                <text x="15" y="45" font-size="10" fill="#6b7280">DISPUTE WORKFLOW</text>
            </svg>`,

            // Arrow/Direction Scene - Forward progress arrow
            'arrowRight': `<svg viewBox="0 0 200 150" fill="none">
                <!-- Background track -->
                <rect x="20" y="65" width="140" height="20" fill="#e5e7eb" rx="10"/>

                <!-- Progress fill -->
                <rect x="20" y="65" width="90" height="20" fill="#3b82f6" rx="10"/>

                <!-- Main arrow -->
                <polygon points="165,75 140,50 140,62 100,62 100,88 140,88 140,100" fill="#1d4ed8"/>

                <!-- Speed lines -->
                <line x1="85" y1="60" x2="70" y2="60" stroke="#60a5fa" stroke-width="2"/>
                <line x1="80" y1="75" x2="60" y2="75" stroke="#60a5fa" stroke-width="3"/>
                <line x1="85" y1="90" x2="70" y2="90" stroke="#60a5fa" stroke-width="2"/>

                <!-- Milestone markers -->
                <circle cx="45" cy="75" r="8" fill="#16a34a" stroke="#fff" stroke-width="2"/>
                <path d="M41 75 L44 78 L50 72" stroke="#fff" stroke-width="2" fill="none"/>

                <circle cx="90" cy="75" r="8" fill="#16a34a" stroke="#fff" stroke-width="2"/>
                <path d="M86 75 L89 78 L95 72" stroke="#fff" stroke-width="2" fill="none"/>

                <!-- Next step label -->
                <text x="145" y="120" font-size="10" fill="#374151">NEXT STEP</text>
            </svg>`
        };

        // Map speech segments to visual sequences
        // Format: 'slideNum-segmentNum': array of visual configs
        // Each visual has: visual (key), position, delay (ms), duration (ms)
        const segmentVisuals = {
            // Slide 1, Segment 1: "Welcome to our deep dive into Pismo Disputes"
            '1-1': [
                { visual: 'stateMachine', position: 'visual-left', delay: 0, duration: 3000 },
                { visual: 'card', position: 'visual-right', delay: 500, duration: 2500 }
            ],
            // Slide 1, Segment 2: "UX side of things"
            '1-2': [
                { visual: 'user', position: 'visual-center', delay: 0, duration: 2500 }
            ],
            // Slide 1, Segment 3: "Build dispute workflow dialogs"
            '1-3': [
                { visual: 'workflow', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'document', position: 'visual-right', delay: 800, duration: 2000 }
            ],
            // Slide 1, Segment 4: "Blueprint for building disputes system"
            '1-4': [
                { visual: 'bank', position: 'visual-center', delay: 0, duration: 2500 }
            ],

            // Slide 2, Segment 1: "Wait, I didn't buy that"
            '2-1': [
                { visual: 'card', position: 'visual-left', delay: 0, duration: 2500 },
                { visual: 'question', position: 'visual-right', delay: 500, duration: 2000 }
            ],
            // Slide 2, Segment 2: "returned that item", "subscription cancelled"
            '2-2': [
                { visual: 'return', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'subscription', position: 'visual-center', delay: 1000, duration: 2000 },
                { visual: 'question', position: 'visual-right', delay: 2000, duration: 2000 }
            ],
            // Slide 2, Segment 3: "$200B annually"
            '2-3': [
                { visual: 'money', position: 'visual-center', delay: 0, duration: 3000 }
            ],
            // Slide 2, Segment 4: "recovering funds, network compliance"
            '2-4': [
                { visual: 'bank', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'network', position: 'visual-right', delay: 800, duration: 2000 }
            ],
            // Slide 2, Segment 5: "customer satisfaction"
            '2-5': [
                { visual: 'user', position: 'visual-center', delay: 0, duration: 2500 }
            ],

            // Slide 3, Segment 1: "Merchant Error - merchant messed something up"
            '3-1': [
                { visual: 'store', position: 'visual-center', delay: 0, duration: 2500 }
            ],
            // Slide 3, Segment 2: "Wrong amount, duplicate, goods never arrived"
            '3-2': [
                { visual: 'card', position: 'visual-left', delay: 0, duration: 1800 },
                { visual: 'package', position: 'visual-center', delay: 800, duration: 1800 },
                { visual: 'document', position: 'visual-right', delay: 1600, duration: 1800 }
            ],
            // Slide 3, Segment 3: "Identity Fraud - card details stolen"
            '3-3': [
                { visual: 'fraud', position: 'visual-center', delay: 0, duration: 3000 }
            ],
            // Slide 3, Segment 4: "Most evidence - police reports, IP logs"
            '3-4': [
                { visual: 'document', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'shield', position: 'visual-right', delay: 600, duration: 2000 }
            ],
            // Slide 3, Segment 5: "Friendly Fraud - actually did make purchase"
            '3-5': [
                { visual: 'user', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'card', position: 'visual-center', delay: 500, duration: 2000 },
                { visual: 'question', position: 'visual-right', delay: 1000, duration: 2000 }
            ],
            // Slide 3, Segment 6: "buyer's remorse, free stuff"
            '3-6': [
                { visual: 'money', position: 'visual-center', delay: 0, duration: 2500 }
            ],

            // Slide 4, Segment 1: "PRIMITIVE state machine"
            '4-1': [
                { visual: 'stateMachine', position: 'visual-center', delay: 0, duration: 3000 }
            ],
            // Slide 4, Segment 2: "Flexibility for issuers"
            '4-2': [
                { visual: 'workflow', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'bank', position: 'visual-right', delay: 500, duration: 2000 }
            ],
            // Slide 4, Segment 3: "Move through states via events"
            '4-3': [
                { visual: 'arrowRight', position: 'visual-left', delay: 0, duration: 1500 },
                { visual: 'stateMachine', position: 'visual-center', delay: 500, duration: 2000 },
                { visual: 'arrowRight', position: 'visual-right', delay: 1000, duration: 1500 }
            ],
            // Slide 4, Segment 4: "Eight major groups - like chapters in a book"
            '4-4': [
                { visual: 'document', position: 'visual-center', delay: 0, duration: 2500 }
            ],
            // Slide 4, Segment 5: "OPEN, CARDNETWORK_CHARGEBACK..." (all groups)
            '4-5': [
                { visual: 'workflow', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'check', position: 'visual-center', delay: 800, duration: 1500 },
                { visual: 'x', position: 'visual-right', delay: 1600, duration: 1500 }
            ],

            // Slide 5, Segment 1: "OPEN - where everything begins - PENDING state"
            '5-1': [
                { visual: 'clock', position: 'visual-center', delay: 0, duration: 2500 }
            ],
            // Slide 5, Segment 2: "CARDNETWORK_CHARGEBACK - active phase"
            '5-2': [
                { visual: 'network', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'card', position: 'visual-right', delay: 500, duration: 2000 }
            ],
            // Slide 5, Segment 3: "SECOND_PRESENTMENT - acquirer fights back"
            '5-3': [
                { visual: 'store', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'return', position: 'visual-right', delay: 500, duration: 2000 }
            ],
            // Slide 5, Segment 4: "PRE-ARBITRATION - escalation zone"
            '5-4': [
                { visual: 'network', position: 'visual-center', delay: 0, duration: 2500 }
            ],
            // Slide 5, Segment 5: "Terminal groups - DENIED, FAILED, LOSS, WON"
            '5-5': [
                { visual: 'check', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'x', position: 'visual-right', delay: 500, duration: 2000 }
            ],
            // Slide 5, Segment 6: "UI needs to communicate outcome"
            '5-6': [
                { visual: 'money', position: 'visual-center', delay: 0, duration: 2500 }
            ],

            // Slide 6, Segment 1: "Big picture - four main phases"
            '6-1': [
                { visual: 'workflow', position: 'visual-center', delay: 0, duration: 2500 }
            ],
            // Slide 6, Segment 2: "Phase 1 - Dispute Creation"
            '6-2': [
                { visual: 'user', position: 'visual-left', delay: 0, duration: 1500 },
                { visual: 'bank', position: 'visual-center', delay: 500, duration: 1500 },
                { visual: 'document', position: 'visual-right', delay: 1000, duration: 1500 }
            ],
            // Slide 6, Segment 3: "Phase 2 - Network Processing"
            '6-3': [
                { visual: 'network', position: 'visual-center', delay: 0, duration: 2500 }
            ],
            // Slide 6, Segment 4: "Phase 3 - Resolution - multiple rounds"
            '6-4': [
                { visual: 'store', position: 'visual-left', delay: 0, duration: 2000 },
                { visual: 'subscription', position: 'visual-right', delay: 500, duration: 2000 }
            ],
            // Slide 6, Segment 5: "Phase 4 - Terminal States"
            '6-5': [
                { visual: 'check', position: 'visual-left', delay: 0, duration: 1800 },
                { visual: 'x', position: 'visual-right', delay: 400, duration: 1800 }
            ],
            // Slide 6, Segment 6: "Few days to several months"
            '6-6': [
                { visual: 'clock', position: 'visual-center', delay: 0, duration: 2500 }
            ]
        };

        // Show contextual floating visuals for a segment
        function showSegmentVisuals(segmentKey) {
            const visuals = segmentVisuals[segmentKey];
            if (!visuals) return;

            const container = document.getElementById('contextual-visuals');
            if (!container) return;

            visuals.forEach(({ visual, position, delay, duration }) => {
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = `floating-visual ${position}`;
                    div.innerHTML = speechVisuals[visual] || '';

                    if (!div.innerHTML) return;

                    container.appendChild(div);

                    // Slide in from right
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            div.classList.add('slide-in');
                        });
                    });

                    // After slide-in completes, add gentle float
                    setTimeout(() => {
                        div.classList.remove('slide-in');
                        div.classList.add('floating');
                        div.style.opacity = '1';
                    }, 800);

                    // Slide out to left before removing
                    setTimeout(() => {
                        div.classList.remove('floating');
                        div.classList.add('slide-out');
                        setTimeout(() => div.remove(), 700);
                    }, duration);
                }, delay);
            });
        }

        // Clear all contextual visuals
        function clearContextualVisuals() {
            const container = document.getElementById('contextual-visuals');
            if (container) {
                container.innerHTML = '';
            }
        }

        // Show icon hint before content reveals
        function showIconHint(iconKey) {
            const container = document.getElementById('icon-container');
            const hint = document.getElementById('icon-hint');

            if (!iconKey || !container || !hint) return;

            // Handle single icon or array of icons
            const icons = Array.isArray(iconKey) ? iconKey : [iconKey];

            // Build HTML for icons
            let iconHtml = '';
            icons.forEach(key => {
                const icon = conceptIcons[key];
                if (icon) {
                    iconHtml += icon;
                }
            });

            if (!iconHtml) return;

            // Set multi-icon class if needed
            if (icons.length > 1) {
                container.classList.add('multi-icon');
            } else {
                container.classList.remove('multi-icon');
            }

            container.innerHTML = iconHtml;
            hint.classList.remove('opacity-0');

            // Add pulse animation to each SVG
            const svgs = container.querySelectorAll('svg');
            svgs.forEach((svg, index) => {
                // Slight delay for each icon in multi-icon display
                setTimeout(() => {
                    svg.classList.add('icon-pulse');
                }, index * 100);
            });

            // Auto-hide after animation completes
            setTimeout(() => {
                hint.classList.add('opacity-0');
                // Clean up after fade
                setTimeout(() => {
                    container.innerHTML = '';
                    container.classList.remove('multi-icon');
                }, 300);
            }, 1500);
        }

        function playSegment(segmentIndex) {
            const slideNum = currentSlide + 1; // Convert to 1-indexed
            const segments = slideAudio[slideNum];
            const currentSlideEl = slides[currentSlide];

            // Segment number is 1-indexed for data attributes
            const segmentNum = segmentIndex + 1;

            // Build segment key for icon lookup
            const segmentKey = `${slideNum}-${segmentNum}`;

            // Show icon hint FIRST (before content reveals)
            if (segmentIcons[segmentKey]) {
                showIconHint(segmentIcons[segmentKey]);
            }

            // Show contextual floating visuals for this segment
            showSegmentVisuals(segmentKey);

            // Reveal elements for this segment - AFTER SVG animation finishes
            // Sequence: SVG appears (0-2s)  SVG fades (2s)  Content reveals (2.5s+)
            const revealElements = currentSlideEl.querySelectorAll(`[data-reveal-segment="${segmentNum}"]`);
            revealElements.forEach((el, index) => {
                if (!el.classList.contains('revealed')) {
                    // Get custom delay from data attribute, or default to 2.5 seconds (after SVG finishes)
                    const delay = parseInt(el.getAttribute('data-reveal-delay') || '2500', 10);
                    setTimeout(() => {
                        if (!el.classList.contains('revealed')) {
                            revealElement(el);
                        }
                    }, delay + (index * 400)); // Stagger multiple reveals
                }
            });

            // Highlight elements for this segment
            const highlightElements = currentSlideEl.querySelectorAll(`[data-highlight-segment="${segmentNum}"]`);
            highlightElements.forEach(el => {
                highlightElement(el);
            });

            if (!segments || segmentIndex >= segments.length) {
                // All segments finished
                isPlaying = false;
                currentSegmentIndex = 0;
                updateAudioButtonIcon();
                hideSubtitle();

                // Auto-advance to next slide if enabled
                if (autoPlayEnabled && currentSlide < totalSlides - 1) {
                    setTimeout(() => {
                        nextSlide();
                        // Auto-start audio on next slide
                        setTimeout(() => toggleAudio(), 500);
                    }, 1000);
                }
                return;
            }

            const audioFile = segments[segmentIndex];
            const fullSrc = 'assets/audio/' + audioFile;

            // Show subtitle for this segment
            const subtitles = slideSubtitles[slideNum];
            if (subtitles && subtitles[segmentIndex]) {
                showSubtitle(subtitles[segmentIndex].speaker, subtitles[segmentIndex].text);
            }

            currentAudio = audioCache[fullSrc] || new Audio(fullSrc);
            currentSegmentIndex = segmentIndex;

            currentAudio.onended = () => {
                // Play next segment
                playSegment(segmentIndex + 1);
            };

            currentAudio.onerror = () => {
                console.log('Audio not available:', fullSrc);
                // Try next segment
                playSegment(segmentIndex + 1);
            };

            currentAudio.play().catch(e => {
                console.log('Audio play failed:', e);
                playSegment(segmentIndex + 1);
            });
        }

        function toggleAudio() {
            const slideNum = currentSlide + 1;
            const segments = slideAudio[slideNum];

            if (!segments || segments.length === 0) return;

            if (isPlaying && currentAudio) {
                currentAudio.pause();
                isPlaying = false;
                updateAudioButtonIcon();
                hideSubtitle();
            } else {
                isPlaying = true;
                updateAudioButtonIcon();
                playSegment(currentSegmentIndex);
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            updateAutoPlayButtonIcon();
        }

        // Event listeners
        prevBtn.addEventListener('click', prevSlide);
        nextBtn.addEventListener('click', nextSlide);
        audioBtn.addEventListener('click', toggleAudio);
        autoPlayBtn.addEventListener('click', toggleAutoPlay);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevSlide();
            }
        });



        // Dagre-D3 State Machine Diagram with automatic layout
        function initD3StateMachine() {
            const container = document.getElementById('state-machine-d3');
            if (!container) return;

            // Clear any existing content
            container.innerHTML = '';

            const width = container.clientWidth || 900;
            const height = 420;

            // Create a new directed graph using dagre-d3
            const g = new dagreD3.graphlib.Graph()
                .setGraph({
                    rankdir: 'TB',  // Top to bottom layout
                    nodesep: 60,    // Horizontal separation between nodes
                    ranksep: 55,    // Vertical separation between ranks
                    marginx: 30,
                    marginy: 20,
                    ranker: 'network-simplex'
                })
                .setDefaultEdgeLabel(function() { return {}; });

            // Define states with their visual properties
            const stateConfig = {
                'PENDING': { label: 'PENDING', class: 'state-blue' },
                'OPENED': { label: 'OPENED', class: 'state-blue' },
                'DENIED': { label: 'DENIED', class: 'state-gray' },
                'FAILED': { label: 'FAILED', class: 'state-gray' },
                'CHARGEBACK_CREATED': { label: 'CHARGEBACK\nCREATED', class: 'state-amber' },
                'CHARGEBACK_ACCEPTED': { label: 'CHARGEBACK\nACCEPTED', class: 'state-green' },
                'CHARGEBACK_REJECTED': { label: 'CHARGEBACK\nREJECTED', class: 'state-red' },
                'SECOND_PRESENTMENT': { label: 'SECOND\nPRESENTMENT', class: 'state-amber' },
                'EXPIRED': { label: 'EXPIRED', class: 'state-gray' },
                'PRE_ARB_OPENED': { label: 'PRE-ARB\nOPENED', class: 'state-purple' },
                'PRE_ARB_ACCEPTED': { label: 'PRE-ARB\nACCEPTED', class: 'state-green' },
                'PRE_ARB_DECLINED': { label: 'PRE-ARB\nDECLINED', class: 'state-red' }
            };

            // Add nodes to the graph
            Object.keys(stateConfig).forEach(stateId => {
                const config = stateConfig[stateId];
                g.setNode(stateId, {
                    label: config.label,
                    class: config.class,
                    rx: 8,
                    ry: 8,
                    padding: 10,
                    style: 'cursor: pointer'
                });
            });

            // Define edges (transitions)
            const edges = [
                { source: 'PENDING', target: 'OPENED', label: 'OPEN', class: '' },
                { source: 'OPENED', target: 'DENIED', label: '', class: '' },
                { source: 'OPENED', target: 'FAILED', label: '', class: '' },
                { source: 'OPENED', target: 'CHARGEBACK_CREATED', label: '', class: '' },
                { source: 'CHARGEBACK_CREATED', target: 'CHARGEBACK_ACCEPTED', label: 'WIN', class: 'edge-green' },
                { source: 'CHARGEBACK_CREATED', target: 'CHARGEBACK_REJECTED', label: 'LOSS', class: 'edge-red' },
                { source: 'CHARGEBACK_CREATED', target: 'SECOND_PRESENTMENT', label: '', class: '' },
                { source: 'FAILED', target: 'OPENED', label: 'RESEND', class: 'edge-dashed' },
                { source: 'SECOND_PRESENTMENT', target: 'CHARGEBACK_ACCEPTED', label: '', class: 'edge-green' },
                { source: 'SECOND_PRESENTMENT', target: 'EXPIRED', label: '', class: '' },
                { source: 'SECOND_PRESENTMENT', target: 'PRE_ARB_OPENED', label: '', class: '' },
                { source: 'PRE_ARB_OPENED', target: 'PRE_ARB_ACCEPTED', label: 'WIN', class: 'edge-green' },
                { source: 'PRE_ARB_OPENED', target: 'PRE_ARB_DECLINED', label: 'LOSS', class: 'edge-red' }
            ];

            // Add edges to the graph
            edges.forEach(edge => {
                const edgeOptions = {
                    curve: d3.curveBasis,
                    class: edge.class
                };
                if (edge.label) {
                    edgeOptions.label = edge.label;
                    edgeOptions.labelStyle = 'font-size: 10px; font-weight: 600;';
                    if (edge.class === 'edge-green') {
                        edgeOptions.labelStyle += ' fill: #16a34a;';
                    } else if (edge.class === 'edge-red') {
                        edgeOptions.labelStyle += ' fill: #dc2626;';
                    } else {
                        edgeOptions.labelStyle += ' fill: #6b7280;';
                    }
                }
                g.setEdge(edge.source, edge.target, edgeOptions);
            });

            // Create SVG element
            const svg = d3.select(container)
                .append('svg')
                .attr('width', '100%')
                .attr('height', height)
                .attr('class', 'dagre-state-machine')
                .style('font-family', 'system-ui, -apple-system, sans-serif');

            // Create inner group for the graph
            const inner = svg.append('g');

            // Define arrow markers
            const defs = svg.append('defs');

            // Default gray arrow marker
            defs.append('marker')
                .attr('id', 'dagre-arrow-gray')
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .attr('refX', 7)
                .attr('refY', 4)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,0 L8,4 L0,8 L2,4 Z')
                .attr('fill', '#6b7280');

            // Green arrow marker
            defs.append('marker')
                .attr('id', 'dagre-arrow-green')
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .attr('refX', 7)
                .attr('refY', 4)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,0 L8,4 L0,8 L2,4 Z')
                .attr('fill', '#16a34a');

            // Red arrow marker
            defs.append('marker')
                .attr('id', 'dagre-arrow-red')
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .attr('refX', 7)
                .attr('refY', 4)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,0 L8,4 L0,8 L2,4 Z')
                .attr('fill', '#dc2626');

            // Create the renderer
            const render = new dagreD3.render();

            // Run the renderer to draw the graph
            render(inner, g);

            // Get the graph dimensions after rendering
            const graphWidth = g.graph().width;
            const graphHeight = g.graph().height;

            // Center the graph in the SVG
            const xCenterOffset = (width - graphWidth) / 2;
            const yCenterOffset = Math.max(10, (height - graphHeight) / 2);
            inner.attr('transform', 'translate(' + xCenterOffset + ',' + yCenterOffset + ')');

            // Set viewBox for responsive scaling
            svg.attr('viewBox', '0 0 ' + width + ' ' + height);

            // Apply custom arrow markers based on edge class
            svg.selectAll('.edgePath').each(function() {
                const edgePath = d3.select(this);
                const path = edgePath.select('path.path');

                if (edgePath.classed('edge-green')) {
                    path.attr('marker-end', 'url(#dagre-arrow-green)');
                } else if (edgePath.classed('edge-red')) {
                    path.attr('marker-end', 'url(#dagre-arrow-red)');
                } else {
                    path.attr('marker-end', 'url(#dagre-arrow-gray)');
                }
            });

            // Style node labels
            svg.selectAll('.node').each(function() {
                const node = d3.select(this);
                const nodeClass = node.attr('class');

                // Style text based on node class
                const text = node.select('g.label');
                text.selectAll('tspan, text').style('font-weight', '600').style('font-size', '11px');

                if (nodeClass.includes('state-blue')) {
                    text.selectAll('tspan, text').style('fill', '#1e40af');
                } else if (nodeClass.includes('state-amber')) {
                    text.selectAll('tspan, text').style('fill', '#92400e');
                } else if (nodeClass.includes('state-green')) {
                    text.selectAll('tspan, text').style('fill', '#166534');
                } else if (nodeClass.includes('state-red')) {
                    text.selectAll('tspan, text').style('fill', '#991b1b');
                } else if (nodeClass.includes('state-gray')) {
                    text.selectAll('tspan, text').style('fill', '#374151');
                } else if (nodeClass.includes('state-purple')) {
                    text.selectAll('tspan, text').style('fill', '#4338ca');
                }
            });

            // Add hover effects to nodes
            svg.selectAll('.node')
                .on('mouseover', function() {
                    d3.select(this).select('rect')
                        .transition()
                        .duration(200)
                        .style('stroke-width', '3px')
                        .style('filter', 'drop-shadow(0 4px 6px rgba(0, 0, 0, 0.15))');
                })
                .on('mouseout', function() {
                    d3.select(this).select('rect')
                        .transition()
                        .duration(200)
                        .style('stroke-width', '2px')
                        .style('filter', 'none');
                });

            // Initially hide elements for animation
            svg.selectAll('.node').style('opacity', 0);
            svg.selectAll('.edgePath').style('opacity', 0);
            svg.selectAll('.edgeLabel').style('opacity', 0);
        }

        // Animate the dagre-d3 state machine when slide 4 becomes active
        function animateD3StateMachine() {
            const svg = d3.select('#state-machine-d3 svg');
            if (svg.empty()) return;

            const nodes = svg.selectAll('.node');
            const edges = svg.selectAll('.edgePath');
            const labels = svg.selectAll('.edgeLabel');

            // Animate nodes appearing
            nodes.each(function(d, i) {
                d3.select(this)
                    .transition()
                    .delay(i * 60)
                    .duration(400)
                    .style('opacity', 1);
            });

            // Animate edges with path drawing effect
            edges.each(function(d, i) {
                const edgePath = d3.select(this);
                const path = edgePath.select('path.path');
                const pathNode = path.node();

                if (pathNode) {
                    const pathLength = pathNode.getTotalLength();
                    path
                        .attr('stroke-dasharray', pathLength + ' ' + pathLength)
                        .attr('stroke-dashoffset', pathLength);

                    edgePath
                        .style('opacity', 1)
                        .select('path.path')
                        .transition()
                        .delay(200 + i * 40)
                        .duration(400)
                        .attr('stroke-dashoffset', 0);
                } else {
                    edgePath
                        .transition()
                        .delay(200 + i * 40)
                        .duration(400)
                        .style('opacity', 1);
                }
            });

            // Animate edge labels
            labels.each(function(d, i) {
                d3.select(this)
                    .transition()
                    .delay(400 + i * 40)
                    .duration(300)
                    .style('opacity', 1);
            });
        }

        // Initialize D3 diagram on page load
        initD3StateMachine();

        // Store original goToSlide reference before overriding
        const originalGoToSlide = goToSlide;

        // Override goToSlide to trigger D3 animation for slide 4
        goToSlide = function(index) {
            originalGoToSlide(index);

            // If navigating to slide 4 (index 3), animate the D3 diagram
            if (index === 3) {
                setTimeout(animateD3StateMachine, 300);
            }
        };

        // Handle window resize
        window.addEventListener('resize', function() {
            if (currentSlide === 3) {
                initD3StateMachine();
                animateD3StateMachine();
            }
        });

        // Initialize
        updateUI();
        updateAutoPlayButtonIcon();
        animateSlideIn(slides[0]);

        // If starting on slide 4, initialize D3
        if (currentSlide === 3) {
            setTimeout(animateD3StateMachine, 500);
        }
    </script>
</body>
</html>
